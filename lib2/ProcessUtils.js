'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;
var _default = {
  injectModules: function injectModules() {
    if (process.env.pmx !== 'false') {
      var pmx = require('@pm2/io');

      var conf = {};
      var hasSpecificConfig = typeof process.env.io === 'string' || process.env.trace === 'true'; // pmx is already init, no need to do it twice

      if (hasSpecificConfig === false) return;

      if (process.env.io) {
        var io = JSON.parse(process.env.io);
        conf = io.conf ? io.conf : conf;
      }

      pmx.init(Object.assign({
        tracing: process.env.trace === 'true' || false
      }, conf));
    }
  },
  isESModule: function isESModule(exec_path) {
    var fs = require('fs');

    var path = require('path');

    var semver = require('semver');

    var data;
    if (semver.satisfies(process.version, '< 13.3.0')) return false;
    if (path.extname(exec_path) === '.mjs') return true;

    try {
      data = JSON.parse(fs.readFileSync(path.join(path.dirname(exec_path), 'package.json')));
      if (data.type === 'module') return true;else return false;
    } catch (e) {}

    try {
      data = JSON.parse(fs.readFileSync(path.join(path.dirname(exec_path), '..', 'package.json')));
      if (data.type === 'module') return true;else return false;
    } catch (e) {
      return false;
    }
  }
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Qcm9jZXNzVXRpbHMudHMiXSwibmFtZXMiOlsiaW5qZWN0TW9kdWxlcyIsInByb2Nlc3MiLCJlbnYiLCJwbXgiLCJyZXF1aXJlIiwiY29uZiIsImhhc1NwZWNpZmljQ29uZmlnIiwiaW8iLCJ0cmFjZSIsIkpTT04iLCJwYXJzZSIsImluaXQiLCJPYmplY3QiLCJhc3NpZ24iLCJ0cmFjaW5nIiwiaXNFU01vZHVsZSIsImV4ZWNfcGF0aCIsImZzIiwicGF0aCIsInNlbXZlciIsImRhdGEiLCJzYXRpc2ZpZXMiLCJ2ZXJzaW9uIiwiZXh0bmFtZSIsInJlYWRGaWxlU3luYyIsImpvaW4iLCJkaXJuYW1lIiwidHlwZSIsImUiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7ZUFFZTtBQUNiQSxFQUFBQSxhQUFhLEVBQUUseUJBQVc7QUFDeEIsUUFBSUMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLEdBQVosS0FBb0IsT0FBeEIsRUFBaUM7QUFDL0IsVUFBTUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsU0FBRCxDQUFuQjs7QUFFQSxVQUFJQyxJQUFJLEdBQUcsRUFBWDtBQUNBLFVBQU1DLGlCQUFpQixHQUFHLE9BQU9MLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSyxFQUFuQixLQUEwQixRQUExQixJQUFzQ04sT0FBTyxDQUFDQyxHQUFSLENBQVlNLEtBQVosS0FBc0IsTUFBdEYsQ0FKK0IsQ0FLL0I7O0FBQ0EsVUFBSUYsaUJBQWlCLEtBQUssS0FBMUIsRUFBaUM7O0FBRWpDLFVBQUlMLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSyxFQUFoQixFQUFvQjtBQUNsQixZQUFNQSxFQUFFLEdBQUdFLElBQUksQ0FBQ0MsS0FBTCxDQUFXVCxPQUFPLENBQUNDLEdBQVIsQ0FBWUssRUFBdkIsQ0FBWDtBQUNBRixRQUFBQSxJQUFJLEdBQUdFLEVBQUUsQ0FBQ0YsSUFBSCxHQUFVRSxFQUFFLENBQUNGLElBQWIsR0FBb0JBLElBQTNCO0FBQ0Q7O0FBQ0RGLE1BQUFBLEdBQUcsQ0FBQ1EsSUFBSixDQUFTQyxNQUFNLENBQUNDLE1BQVAsQ0FBYztBQUNyQkMsUUFBQUEsT0FBTyxFQUFFYixPQUFPLENBQUNDLEdBQVIsQ0FBWU0sS0FBWixLQUFzQixNQUF0QixJQUFnQztBQURwQixPQUFkLEVBRU5ILElBRk0sQ0FBVDtBQUdEO0FBQ0YsR0FsQlk7QUFtQmJVLEVBQUFBLFVBbkJhLHNCQW1CRkMsU0FuQkUsRUFtQlM7QUFDcEIsUUFBSUMsRUFBRSxHQUFHYixPQUFPLENBQUMsSUFBRCxDQUFoQjs7QUFDQSxRQUFJYyxJQUFJLEdBQUdkLE9BQU8sQ0FBQyxNQUFELENBQWxCOztBQUNBLFFBQUllLE1BQU0sR0FBR2YsT0FBTyxDQUFDLFFBQUQsQ0FBcEI7O0FBQ0EsUUFBSWdCLElBQUo7QUFFQSxRQUFJRCxNQUFNLENBQUNFLFNBQVAsQ0FBaUJwQixPQUFPLENBQUNxQixPQUF6QixFQUFrQyxVQUFsQyxDQUFKLEVBQ0UsT0FBTyxLQUFQO0FBRUYsUUFBSUosSUFBSSxDQUFDSyxPQUFMLENBQWFQLFNBQWIsTUFBNEIsTUFBaEMsRUFDRSxPQUFPLElBQVA7O0FBRUYsUUFBSTtBQUNGSSxNQUFBQSxJQUFJLEdBQUdYLElBQUksQ0FBQ0MsS0FBTCxDQUFXTyxFQUFFLENBQUNPLFlBQUgsQ0FBZ0JOLElBQUksQ0FBQ08sSUFBTCxDQUFVUCxJQUFJLENBQUNRLE9BQUwsQ0FBYVYsU0FBYixDQUFWLEVBQW1DLGNBQW5DLENBQWhCLENBQVgsQ0FBUDtBQUNBLFVBQUlJLElBQUksQ0FBQ08sSUFBTCxLQUFjLFFBQWxCLEVBQ0UsT0FBTyxJQUFQLENBREYsS0FHRSxPQUFPLEtBQVA7QUFDSCxLQU5ELENBTUUsT0FBTUMsQ0FBTixFQUFTLENBQ1Y7O0FBRUQsUUFBSTtBQUNGUixNQUFBQSxJQUFJLEdBQUdYLElBQUksQ0FBQ0MsS0FBTCxDQUFXTyxFQUFFLENBQUNPLFlBQUgsQ0FBZ0JOLElBQUksQ0FBQ08sSUFBTCxDQUFVUCxJQUFJLENBQUNRLE9BQUwsQ0FBYVYsU0FBYixDQUFWLEVBQW1DLElBQW5DLEVBQXlDLGNBQXpDLENBQWhCLENBQVgsQ0FBUDtBQUNBLFVBQUlJLElBQUksQ0FBQ08sSUFBTCxLQUFjLFFBQWxCLEVBQ0UsT0FBTyxJQUFQLENBREYsS0FHRSxPQUFPLEtBQVA7QUFDSCxLQU5ELENBTUUsT0FBTUMsQ0FBTixFQUFTO0FBQ1QsYUFBTyxLQUFQO0FBQ0Q7QUFDRjtBQWpEWSxDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgaW5qZWN0TW9kdWxlczogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHByb2Nlc3MuZW52LnBteCAhPT0gJ2ZhbHNlJykge1xuICAgICAgY29uc3QgcG14ID0gcmVxdWlyZSgnQHBtMi9pbycpXG5cbiAgICAgIGxldCBjb25mID0ge31cbiAgICAgIGNvbnN0IGhhc1NwZWNpZmljQ29uZmlnID0gdHlwZW9mIHByb2Nlc3MuZW52LmlvID09PSAnc3RyaW5nJyB8fCBwcm9jZXNzLmVudi50cmFjZSA9PT0gJ3RydWUnXG4gICAgICAvLyBwbXggaXMgYWxyZWFkeSBpbml0LCBubyBuZWVkIHRvIGRvIGl0IHR3aWNlXG4gICAgICBpZiAoaGFzU3BlY2lmaWNDb25maWcgPT09IGZhbHNlKSByZXR1cm5cblxuICAgICAgaWYgKHByb2Nlc3MuZW52LmlvKSB7XG4gICAgICAgIGNvbnN0IGlvID0gSlNPTi5wYXJzZShwcm9jZXNzLmVudi5pbylcbiAgICAgICAgY29uZiA9IGlvLmNvbmYgPyBpby5jb25mIDogY29uZlxuICAgICAgfVxuICAgICAgcG14LmluaXQoT2JqZWN0LmFzc2lnbih7XG4gICAgICAgIHRyYWNpbmc6IHByb2Nlc3MuZW52LnRyYWNlID09PSAndHJ1ZScgfHwgZmFsc2VcbiAgICAgIH0sIGNvbmYpKVxuICAgIH1cbiAgfSxcbiAgaXNFU01vZHVsZShleGVjX3BhdGgpIHtcbiAgICB2YXIgZnMgPSByZXF1aXJlKCdmcycpXG4gICAgdmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJylcbiAgICB2YXIgc2VtdmVyID0gcmVxdWlyZSgnc2VtdmVyJylcbiAgICB2YXIgZGF0YVxuXG4gICAgaWYgKHNlbXZlci5zYXRpc2ZpZXMocHJvY2Vzcy52ZXJzaW9uLCAnPCAxMy4zLjAnKSlcbiAgICAgIHJldHVybiBmYWxzZVxuXG4gICAgaWYgKHBhdGguZXh0bmFtZShleGVjX3BhdGgpID09PSAnLm1qcycpXG4gICAgICByZXR1cm4gdHJ1ZVxuXG4gICAgdHJ5IHtcbiAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4ocGF0aC5kaXJuYW1lKGV4ZWNfcGF0aCksICdwYWNrYWdlLmpzb24nKSkpXG4gICAgICBpZiAoZGF0YS50eXBlID09PSAnbW9kdWxlJylcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSBjYXRjaChlKSB7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4ocGF0aC5kaXJuYW1lKGV4ZWNfcGF0aCksICcuLicsICdwYWNrYWdlLmpzb24nKSkpXG4gICAgICBpZiAoZGF0YS50eXBlID09PSAnbW9kdWxlJylcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSBjYXRjaChlKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cbn1cbiJdfQ==