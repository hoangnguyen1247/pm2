"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = _default;

var _vizion = _interopRequireDefault(require("vizion"));

var _constants = _interopRequireDefault(require("../constants.js"));

var _eachLimit = _interopRequireDefault(require("async/eachLimit"));

var _debug = _interopRequireDefault(require("debug"));

var _domain = _interopRequireDefault(require("domain"));

var _cron = require("cron");

var _VersionCheck = _interopRequireDefault(require("./VersionCheck"));

var _package = _interopRequireDefault(require("../package.json"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

var debug = (0, _debug["default"])('pm2:worker');

function _default(God) {
  var timer = null;
  God.CronJobs = new Map();
  God.Worker = {};
  God.Worker.is_running = false;

  God.getCronID = function (pm_id) {
    return "cron-".concat(pm_id);
  };

  God.registerCron = function (pm2_env) {
    if (!pm2_env || pm2_env.pm_id === undefined || !pm2_env.cron_restart || God.CronJobs.has(God.getCronID(pm2_env.pm_id))) return;
    console.log('[PM2][WORKER] Registering a cron job on:', pm2_env.pm_id);
    var job = new _cron.CronJob({
      cronTime: pm2_env.cron_restart,
      onTick: function onTick() {
        God.softReloadProcessId({
          id: pm2_env.pm_id
        }, function (err, data) {
          if (err) console.error(err.stack || err);
          return;
        });
      },
      start: false
    });
    job.start();
    God.CronJobs.set(God.getCronID(pm2_env.pm_id), job);
  };
  /**
   * Deletes the cron job on deletion of process
   */


  God.deleteCron = function (id) {
    if (typeof id !== 'undefined' && God.CronJobs.has(God.getCronID(id)) === false) return;
    console.log('[PM2] Deregistering a cron job on:', id);
    var job = God.CronJobs.get(God.getCronID(id));
    job.stop();
    God.CronJobs["delete"](God.getCronID(id));
  };

  var _getProcessById = function _getProcessById(pm_id) {
    var proc = God.clusters_db[pm_id];
    return proc ? proc : null;
  };

  var maxMemoryRestart = function maxMemoryRestart(proc_key, cb) {
    var proc = _getProcessById(proc_key.pm2_env.pm_id);

    if (!(proc && proc.pm2_env && proc_key.monit)) return cb();

    if (proc_key.monit.memory !== undefined && proc.pm2_env.max_memory_restart !== undefined && proc.pm2_env.max_memory_restart < proc_key.monit.memory && proc.pm2_env.axm_options && proc.pm2_env.axm_options.pid === undefined) {
      console.log('[PM2][WORKER] Process %s restarted because it exceeds --max-memory-restart value (current_memory=%s max_memory_limit=%s [octets])', proc.pm2_env.pm_id, proc_key.monit.memory, proc.pm2_env.max_memory_restart);
      God.softReloadProcessId({
        id: proc.pm2_env.pm_id
      }, function (err, data) {
        if (err) console.error(err.stack || err);
        return cb();
      });
    } else {
      return cb();
    }
  }; // Deprecated


  var versioningRefresh = function versioningRefresh(proc_key, cb) {
    var proc = _getProcessById(proc_key.pm2_env.pm_id);

    if (!(proc && proc.pm2_env && proc.pm2_env.vizion !== false && proc.pm2_env.vizion != "false" && proc.pm2_env.versioning && proc.pm2_env.versioning.repo_path)) {
      return cb();
    }

    if (proc.pm2_env.vizion_running === true) {
      debug('Vizion is already running for proc id: %d, skipping this round', proc.pm2_env.pm_id);
      return cb();
    }

    proc.pm2_env.vizion_running = true;
    var repo_path = proc.pm2_env.versioning.repo_path;

    _vizion["default"].analyze({
      folder: proc.pm2_env.versioning.repo_path
    }, function (err, meta) {
      if (err != null) return cb();
      proc = _getProcessById(proc_key.pm2_env.pm_id);

      if (!(proc && proc.pm2_env && proc.pm2_env.versioning && proc.pm2_env.versioning.repo_path)) {
        console.error('Proc not defined anymore or versioning unknown');
        return cb();
      }

      proc.pm2_env.vizion_running = false;
      meta.repo_path = repo_path;
      proc.pm2_env.versioning = meta;
      debug('[PM2][WORKER] %s parsed for versioning', proc.pm2_env.name);
      return cb();
    });
  };

  var tasks = function tasks() {
    if (God.Worker.is_running === true) {
      debug('[PM2][WORKER] Worker is already running, skipping this round');
      return false;
    }

    God.Worker.is_running = true;
    God.getMonitorData(null, function (err, data) {
      if (err || !data || _typeof(data) !== 'object') {
        God.Worker.is_running = false;
        return console.error(err);
      }

      (0, _eachLimit["default"])(data, 1, function (proc, next) {
        if (!proc || !proc.pm2_env || proc.pm2_env.pm_id === undefined) return next();
        debug('[PM2][WORKER] Processing proc id:', proc.pm2_env.pm_id); // Reset restart delay if application has an uptime of more > 30secs

        if (proc.pm2_env.exp_backoff_restart_delay !== undefined && proc.pm2_env.prev_restart_delay && proc.pm2_env.prev_restart_delay > 0) {
          var app_uptime = Date.now() - proc.pm2_env.pm_uptime;

          if (app_uptime > _constants["default"].EXP_BACKOFF_RESET_TIMER) {
            var ref_proc = _getProcessById(proc.pm2_env.pm_id);

            ref_proc.pm2_env.prev_restart_delay = 0;
            console.log("[PM2][WORKER] Reset the restart delay, as app ".concat(proc.name, " has been up for more than ").concat(_constants["default"].EXP_BACKOFF_RESET_TIMER, "ms"));
          }
        } // Check if application has reached memory threshold


        maxMemoryRestart(proc, function () {
          return next();
        });
      }, function (err) {
        God.Worker.is_running = false;
        debug('[PM2][WORKER] My job here is done, next job in %d seconds', parseInt(_constants["default"].WORKER_INTERVAL / 1000 + ""));
      });
    });
  };

  var wrappedTasks = function wrappedTasks() {
    var d = _domain["default"].create();

    d.once('error', function (err) {
      console.error('[PM2][WORKER] Error caught by domain:\n' + (err.stack || err));
      God.Worker.is_running = false;
    });
    d.run(function () {
      tasks();
    });
  };

  God.Worker.start = function () {
    timer = setInterval(wrappedTasks, _constants["default"].WORKER_INTERVAL);
    setInterval(function () {
      (0, _VersionCheck["default"])({
        state: 'check',
        version: _package["default"].version
      });
    }, 1000 * 60 * 60 * 24);
  };

  God.Worker.stop = function () {
    if (timer !== null) clearInterval(timer);
  };
}

;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Xb3JrZXIudHMiXSwibmFtZXMiOlsiZGVidWciLCJHb2QiLCJ0aW1lciIsIkNyb25Kb2JzIiwiTWFwIiwiV29ya2VyIiwiaXNfcnVubmluZyIsImdldENyb25JRCIsInBtX2lkIiwicmVnaXN0ZXJDcm9uIiwicG0yX2VudiIsInVuZGVmaW5lZCIsImNyb25fcmVzdGFydCIsImhhcyIsImNvbnNvbGUiLCJsb2ciLCJqb2IiLCJDcm9uSm9iIiwiY3JvblRpbWUiLCJvblRpY2siLCJzb2Z0UmVsb2FkUHJvY2Vzc0lkIiwiaWQiLCJlcnIiLCJkYXRhIiwiZXJyb3IiLCJzdGFjayIsInN0YXJ0Iiwic2V0IiwiZGVsZXRlQ3JvbiIsImdldCIsInN0b3AiLCJfZ2V0UHJvY2Vzc0J5SWQiLCJwcm9jIiwiY2x1c3RlcnNfZGIiLCJtYXhNZW1vcnlSZXN0YXJ0IiwicHJvY19rZXkiLCJjYiIsIm1vbml0IiwibWVtb3J5IiwibWF4X21lbW9yeV9yZXN0YXJ0IiwiYXhtX29wdGlvbnMiLCJwaWQiLCJ2ZXJzaW9uaW5nUmVmcmVzaCIsInZpemlvbiIsInZlcnNpb25pbmciLCJyZXBvX3BhdGgiLCJ2aXppb25fcnVubmluZyIsImFuYWx5emUiLCJmb2xkZXIiLCJtZXRhIiwibmFtZSIsInRhc2tzIiwiZ2V0TW9uaXRvckRhdGEiLCJuZXh0IiwiZXhwX2JhY2tvZmZfcmVzdGFydF9kZWxheSIsInByZXZfcmVzdGFydF9kZWxheSIsImFwcF91cHRpbWUiLCJEYXRlIiwibm93IiwicG1fdXB0aW1lIiwiY3N0IiwiRVhQX0JBQ0tPRkZfUkVTRVRfVElNRVIiLCJyZWZfcHJvYyIsInBhcnNlSW50IiwiV09SS0VSX0lOVEVSVkFMIiwid3JhcHBlZFRhc2tzIiwiZCIsImRvbWFpbiIsImNyZWF0ZSIsIm9uY2UiLCJydW4iLCJzZXRJbnRlcnZhbCIsInN0YXRlIiwidmVyc2lvbiIsInBrZyIsImNsZWFySW50ZXJ2YWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFLQTs7QUFD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QUFKLENBQVd5QixJQUFYLEdBQWtCLFlBQVk7QUFDNUIsUUFBSTVCLEtBQUssS0FBSyxJQUFkLEVBQ0V5RSxhQUFhLENBQUN6RSxLQUFELENBQWI7QUFDSCxHQUhEO0FBSUQ7O0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAyMDEzIHRoZSBQTTIgcHJvamVjdCBhdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBsaWNlbnNlIHRoYXRcbiAqIGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLlxuICovXG5pbXBvcnQgdml6aW9uIGZyb20gJ3Zpemlvbic7XG5pbXBvcnQgY3N0IGZyb20gJy4uL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgZWFjaExpbWl0IGZyb20gJ2FzeW5jL2VhY2hMaW1pdCc7XG5pbXBvcnQgZGVidWdMb2dnZXIgZnJvbSAnZGVidWcnO1xuaW1wb3J0IGRvbWFpbiBmcm9tICdkb21haW4nO1xuaW1wb3J0IHsgQ3JvbkpvYiB9IGZyb20gJ2Nyb24nO1xuaW1wb3J0IHZDaGVjayBmcm9tICcuL1ZlcnNpb25DaGVjayc7XG5pbXBvcnQgcGtnIGZyb20gJy4uL3BhY2thZ2UuanNvbic7XG5cbnZhciBkZWJ1ZyA9IGRlYnVnTG9nZ2VyKCdwbTI6d29ya2VyJyk7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIChHb2QpIHtcbiAgdmFyIHRpbWVyID0gbnVsbDtcblxuICBHb2QuQ3JvbkpvYnMgPSBuZXcgTWFwKCk7XG4gIEdvZC5Xb3JrZXIgPSB7fTtcbiAgR29kLldvcmtlci5pc19ydW5uaW5nID0gZmFsc2U7XG5cbiAgR29kLmdldENyb25JRCA9IGZ1bmN0aW9uIChwbV9pZCkge1xuICAgIHJldHVybiBgY3Jvbi0ke3BtX2lkfWBcbiAgfVxuXG4gIEdvZC5yZWdpc3RlckNyb24gPSBmdW5jdGlvbiAocG0yX2Vudikge1xuICAgIGlmICghcG0yX2VudiB8fFxuICAgICAgcG0yX2Vudi5wbV9pZCA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAhcG0yX2Vudi5jcm9uX3Jlc3RhcnQgfHxcbiAgICAgIEdvZC5Dcm9uSm9icy5oYXMoR29kLmdldENyb25JRChwbTJfZW52LnBtX2lkKSkpXG4gICAgICByZXR1cm47XG5cbiAgICBjb25zb2xlLmxvZygnW1BNMl1bV09SS0VSXSBSZWdpc3RlcmluZyBhIGNyb24gam9iIG9uOicsIHBtMl9lbnYucG1faWQpO1xuXG4gICAgdmFyIGpvYiA9IG5ldyBDcm9uSm9iKHtcbiAgICAgIGNyb25UaW1lOiBwbTJfZW52LmNyb25fcmVzdGFydCxcbiAgICAgIG9uVGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICBHb2Quc29mdFJlbG9hZFByb2Nlc3NJZCh7IGlkOiBwbTJfZW52LnBtX2lkIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgICAgICBpZiAoZXJyKVxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIuc3RhY2sgfHwgZXJyKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIHN0YXJ0OiBmYWxzZVxuICAgIH0pO1xuXG4gICAgam9iLnN0YXJ0KCk7XG4gICAgR29kLkNyb25Kb2JzLnNldChHb2QuZ2V0Q3JvbklEKHBtMl9lbnYucG1faWQpLCBqb2IpO1xuICB9XG5cblxuICAvKipcbiAgICogRGVsZXRlcyB0aGUgY3JvbiBqb2Igb24gZGVsZXRpb24gb2YgcHJvY2Vzc1xuICAgKi9cbiAgR29kLmRlbGV0ZUNyb24gPSBmdW5jdGlvbiAoaWQpIHtcbiAgICBpZiAodHlwZW9mIChpZCkgIT09ICd1bmRlZmluZWQnICYmIEdvZC5Dcm9uSm9icy5oYXMoR29kLmdldENyb25JRChpZCkpID09PSBmYWxzZSlcbiAgICAgIHJldHVybjtcbiAgICBjb25zb2xlLmxvZygnW1BNMl0gRGVyZWdpc3RlcmluZyBhIGNyb24gam9iIG9uOicsIGlkKTtcbiAgICB2YXIgam9iID0gR29kLkNyb25Kb2JzLmdldChHb2QuZ2V0Q3JvbklEKGlkKSk7XG4gICAgam9iLnN0b3AoKTtcbiAgICBHb2QuQ3JvbkpvYnMuZGVsZXRlKEdvZC5nZXRDcm9uSUQoaWQpKTtcbiAgfTtcblxuICB2YXIgX2dldFByb2Nlc3NCeUlkID0gZnVuY3Rpb24gKHBtX2lkKSB7XG4gICAgdmFyIHByb2MgPSBHb2QuY2x1c3RlcnNfZGJbcG1faWRdO1xuICAgIHJldHVybiBwcm9jID8gcHJvYyA6IG51bGw7XG4gIH07XG5cblxuICB2YXIgbWF4TWVtb3J5UmVzdGFydCA9IGZ1bmN0aW9uIChwcm9jX2tleSwgY2IpIHtcbiAgICB2YXIgcHJvYyA9IF9nZXRQcm9jZXNzQnlJZChwcm9jX2tleS5wbTJfZW52LnBtX2lkKTtcblxuICAgIGlmICghKHByb2MgJiZcbiAgICAgIHByb2MucG0yX2VudiAmJlxuICAgICAgcHJvY19rZXkubW9uaXQpKVxuICAgICAgcmV0dXJuIGNiKCk7XG5cbiAgICBpZiAocHJvY19rZXkubW9uaXQubWVtb3J5ICE9PSB1bmRlZmluZWQgJiZcbiAgICAgIHByb2MucG0yX2Vudi5tYXhfbWVtb3J5X3Jlc3RhcnQgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgcHJvYy5wbTJfZW52Lm1heF9tZW1vcnlfcmVzdGFydCA8IHByb2Nfa2V5Lm1vbml0Lm1lbW9yeSAmJlxuICAgICAgcHJvYy5wbTJfZW52LmF4bV9vcHRpb25zICYmXG4gICAgICBwcm9jLnBtMl9lbnYuYXhtX29wdGlvbnMucGlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbUE0yXVtXT1JLRVJdIFByb2Nlc3MgJXMgcmVzdGFydGVkIGJlY2F1c2UgaXQgZXhjZWVkcyAtLW1heC1tZW1vcnktcmVzdGFydCB2YWx1ZSAoY3VycmVudF9tZW1vcnk9JXMgbWF4X21lbW9yeV9saW1pdD0lcyBbb2N0ZXRzXSknLCBwcm9jLnBtMl9lbnYucG1faWQsIHByb2Nfa2V5Lm1vbml0Lm1lbW9yeSwgcHJvYy5wbTJfZW52Lm1heF9tZW1vcnlfcmVzdGFydCk7XG4gICAgICBHb2Quc29mdFJlbG9hZFByb2Nlc3NJZCh7XG4gICAgICAgIGlkOiBwcm9jLnBtMl9lbnYucG1faWRcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgICAgaWYgKGVycilcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVyci5zdGFjayB8fCBlcnIpO1xuICAgICAgICByZXR1cm4gY2IoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBjYigpO1xuICAgIH1cbiAgfTtcblxuICAvLyBEZXByZWNhdGVkXG4gIHZhciB2ZXJzaW9uaW5nUmVmcmVzaCA9IGZ1bmN0aW9uIChwcm9jX2tleSwgY2IpIHtcbiAgICB2YXIgcHJvYyA9IF9nZXRQcm9jZXNzQnlJZChwcm9jX2tleS5wbTJfZW52LnBtX2lkKTtcbiAgICBpZiAoIShwcm9jICYmXG4gICAgICBwcm9jLnBtMl9lbnYgJiZcbiAgICAgIChwcm9jLnBtMl9lbnYudml6aW9uICE9PSBmYWxzZSAmJiBwcm9jLnBtMl9lbnYudml6aW9uICE9IFwiZmFsc2VcIikgJiZcbiAgICAgIHByb2MucG0yX2Vudi52ZXJzaW9uaW5nICYmXG4gICAgICBwcm9jLnBtMl9lbnYudmVyc2lvbmluZy5yZXBvX3BhdGgpKSB7XG4gICAgICByZXR1cm4gY2IoKTtcbiAgICB9XG5cbiAgICBpZiAocHJvYy5wbTJfZW52LnZpemlvbl9ydW5uaW5nID09PSB0cnVlKSB7XG4gICAgICBkZWJ1ZygnVml6aW9uIGlzIGFscmVhZHkgcnVubmluZyBmb3IgcHJvYyBpZDogJWQsIHNraXBwaW5nIHRoaXMgcm91bmQnLCBwcm9jLnBtMl9lbnYucG1faWQpO1xuICAgICAgcmV0dXJuIGNiKCk7XG4gICAgfVxuXG4gICAgcHJvYy5wbTJfZW52LnZpemlvbl9ydW5uaW5nID0gdHJ1ZTtcbiAgICB2YXIgcmVwb19wYXRoID0gcHJvYy5wbTJfZW52LnZlcnNpb25pbmcucmVwb19wYXRoO1xuXG4gICAgdml6aW9uLmFuYWx5emUoe1xuICAgICAgZm9sZGVyOiBwcm9jLnBtMl9lbnYudmVyc2lvbmluZy5yZXBvX3BhdGhcbiAgICB9LFxuICAgICAgZnVuY3Rpb24gKGVyciwgbWV0YSkge1xuICAgICAgICBpZiAoZXJyICE9IG51bGwpXG4gICAgICAgICAgcmV0dXJuIGNiKCk7XG5cbiAgICAgICAgcHJvYyA9IF9nZXRQcm9jZXNzQnlJZChwcm9jX2tleS5wbTJfZW52LnBtX2lkKTtcblxuICAgICAgICBpZiAoIShwcm9jICYmXG4gICAgICAgICAgcHJvYy5wbTJfZW52ICYmXG4gICAgICAgICAgcHJvYy5wbTJfZW52LnZlcnNpb25pbmcgJiZcbiAgICAgICAgICBwcm9jLnBtMl9lbnYudmVyc2lvbmluZy5yZXBvX3BhdGgpKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignUHJvYyBub3QgZGVmaW5lZCBhbnltb3JlIG9yIHZlcnNpb25pbmcgdW5rbm93bicpO1xuICAgICAgICAgIHJldHVybiBjYigpO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJvYy5wbTJfZW52LnZpemlvbl9ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgIG1ldGEucmVwb19wYXRoID0gcmVwb19wYXRoO1xuICAgICAgICBwcm9jLnBtMl9lbnYudmVyc2lvbmluZyA9IG1ldGE7XG4gICAgICAgIGRlYnVnKCdbUE0yXVtXT1JLRVJdICVzIHBhcnNlZCBmb3IgdmVyc2lvbmluZycsIHByb2MucG0yX2Vudi5uYW1lKTtcbiAgICAgICAgcmV0dXJuIGNiKCk7XG4gICAgICB9KTtcbiAgfTtcblxuICB2YXIgdGFza3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEdvZC5Xb3JrZXIuaXNfcnVubmluZyA9PT0gdHJ1ZSkge1xuICAgICAgZGVidWcoJ1tQTTJdW1dPUktFUl0gV29ya2VyIGlzIGFscmVhZHkgcnVubmluZywgc2tpcHBpbmcgdGhpcyByb3VuZCcpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBHb2QuV29ya2VyLmlzX3J1bm5pbmcgPSB0cnVlO1xuXG4gICAgR29kLmdldE1vbml0b3JEYXRhKG51bGwsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgIGlmIChlcnIgfHwgIWRhdGEgfHwgdHlwZW9mIChkYXRhKSAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgR29kLldvcmtlci5pc19ydW5uaW5nID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB9XG5cbiAgICAgIGVhY2hMaW1pdChkYXRhLCAxLCBmdW5jdGlvbiAocHJvYywgbmV4dCkge1xuICAgICAgICBpZiAoIXByb2MgfHwgIXByb2MucG0yX2VudiB8fCBwcm9jLnBtMl9lbnYucG1faWQgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICByZXR1cm4gbmV4dCgpO1xuXG4gICAgICAgIGRlYnVnKCdbUE0yXVtXT1JLRVJdIFByb2Nlc3NpbmcgcHJvYyBpZDonLCBwcm9jLnBtMl9lbnYucG1faWQpO1xuXG4gICAgICAgIC8vIFJlc2V0IHJlc3RhcnQgZGVsYXkgaWYgYXBwbGljYXRpb24gaGFzIGFuIHVwdGltZSBvZiBtb3JlID4gMzBzZWNzXG4gICAgICAgIGlmIChwcm9jLnBtMl9lbnYuZXhwX2JhY2tvZmZfcmVzdGFydF9kZWxheSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgcHJvYy5wbTJfZW52LnByZXZfcmVzdGFydF9kZWxheSAmJiBwcm9jLnBtMl9lbnYucHJldl9yZXN0YXJ0X2RlbGF5ID4gMCkge1xuICAgICAgICAgIHZhciBhcHBfdXB0aW1lID0gRGF0ZS5ub3coKSAtIHByb2MucG0yX2Vudi5wbV91cHRpbWVcbiAgICAgICAgICBpZiAoYXBwX3VwdGltZSA+IGNzdC5FWFBfQkFDS09GRl9SRVNFVF9USU1FUikge1xuICAgICAgICAgICAgdmFyIHJlZl9wcm9jID0gX2dldFByb2Nlc3NCeUlkKHByb2MucG0yX2Vudi5wbV9pZCk7XG4gICAgICAgICAgICByZWZfcHJvYy5wbTJfZW52LnByZXZfcmVzdGFydF9kZWxheSA9IDBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbUE0yXVtXT1JLRVJdIFJlc2V0IHRoZSByZXN0YXJ0IGRlbGF5LCBhcyBhcHAgJHtwcm9jLm5hbWV9IGhhcyBiZWVuIHVwIGZvciBtb3JlIHRoYW4gJHtjc3QuRVhQX0JBQ0tPRkZfUkVTRVRfVElNRVJ9bXNgKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIGFwcGxpY2F0aW9uIGhhcyByZWFjaGVkIG1lbW9yeSB0aHJlc2hvbGRcbiAgICAgICAgbWF4TWVtb3J5UmVzdGFydChwcm9jLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIEdvZC5Xb3JrZXIuaXNfcnVubmluZyA9IGZhbHNlO1xuICAgICAgICBkZWJ1ZygnW1BNMl1bV09SS0VSXSBNeSBqb2IgaGVyZSBpcyBkb25lLCBuZXh0IGpvYiBpbiAlZCBzZWNvbmRzJywgcGFyc2VJbnQoKGNzdC5XT1JLRVJfSU5URVJWQUwgLyAxMDAwKSArIFwiXCIpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIHZhciB3cmFwcGVkVGFza3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGQgPSBkb21haW4uY3JlYXRlKCk7XG5cbiAgICBkLm9uY2UoJ2Vycm9yJywgZnVuY3Rpb24gKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignW1BNMl1bV09SS0VSXSBFcnJvciBjYXVnaHQgYnkgZG9tYWluOlxcbicgKyAoZXJyLnN0YWNrIHx8IGVycikpO1xuICAgICAgR29kLldvcmtlci5pc19ydW5uaW5nID0gZmFsc2U7XG4gICAgfSk7XG5cbiAgICBkLnJ1bihmdW5jdGlvbiAoKSB7XG4gICAgICB0YXNrcygpO1xuICAgIH0pO1xuICB9O1xuXG5cbiAgR29kLldvcmtlci5zdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aW1lciA9IHNldEludGVydmFsKHdyYXBwZWRUYXNrcywgY3N0LldPUktFUl9JTlRFUlZBTCk7XG5cbiAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICB2Q2hlY2soe1xuICAgICAgICBzdGF0ZTogJ2NoZWNrJyxcbiAgICAgICAgdmVyc2lvbjogcGtnLnZlcnNpb25cbiAgICAgIH0pXG4gICAgfSwgMTAwMCAqIDYwICogNjAgKiAyNClcbiAgfTtcblxuICBHb2QuV29ya2VyLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRpbWVyICE9PSBudWxsKVxuICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7XG4gIH07XG59O1xuIl19