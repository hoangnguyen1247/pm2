"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _fs = _interopRequireDefault(require("fs"));

var _util = _interopRequireDefault(require("util"));

var _chalk = _interopRequireDefault(require("chalk"));

var _forEachLimit = _interopRequireDefault(require("async/forEachLimit"));

var _dayjs = _interopRequireDefault(require("dayjs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/**
 * Copyright 2013 the PM2 project authors. All rights reserved.
 * Use of this source code is governed by a license that
 * can be found in the LICENSE file.
 */
var Log = {};
var DEFAULT_PADDING = '          ';
/**
 * Tail logs from file stream.
 * @param {Object} apps_list
 * @param {Number} lines
 * @param {Boolean} raw
 * @param {Function} callback
 * @return
 */

Log.tail = function (apps_list, lines, raw, callback) {
  var that = this;
  if (lines === 0 || apps_list.length === 0) return callback && callback();
  var count = 0;

  var getLastLines = function getLastLines(filename, lines, callback) {
    var chunk = '';
    var size = Math.max(0, _fs["default"].statSync(filename).size - lines * 200);
    var chunkArr;

    var fd = _fs["default"].createReadStream(filename, {
      start: size
    });

    fd.on('data', function (data) {
      chunk += data.toString();
    });
    fd.on('end', function () {
      chunkArr = chunk.split('\n').slice(-(lines + 1));
      chunkArr.pop();
      callback(chunkArr);
    });
  };

  apps_list.sort(function (a, b) {
    return (_fs["default"].existsSync(a.path) ? _fs["default"].statSync(a.path).mtime.valueOf() : 0) - (_fs["default"].existsSync(b.path) ? _fs["default"].statSync(b.path).mtime.valueOf() : 0);
  });
  (0, _forEachLimit["default"])(apps_list, 1, function (app, next) {
    if (!_fs["default"].existsSync(app.path || '')) return next();
    getLastLines(app.path, lines, function (output) {
      console.log(_chalk["default"].grey('%s last %d lines:'), app.path, lines);
      output.forEach(function (out) {
        if (raw) return app.type === 'err' ? console.error(out) : console.log(out);
        if (app.type === 'out') process.stdout.write(_chalk["default"].green(pad(DEFAULT_PADDING, app.app_name) + ' | '));else if (app.type === 'err') process.stdout.write(_chalk["default"].red(pad(DEFAULT_PADDING, app.app_name) + ' | '));else process.stdout.write(_chalk["default"].blue(pad(DEFAULT_PADDING, 'PM2') + ' | '));
        console.log(out);
      });
      if (output.length) process.stdout.write('\n');
      next();
    });
  }, function () {
    callback && callback();
  });
};
/**
 * Stream logs in realtime from the bus eventemitter.
 * @param {String} id
 * @param {Boolean} raw
 * @return
 */


Log.stream = function (Client, id, raw, timestamp, exclusive, highlight) {
  var that = this;
  Client.launchBus(function (err, bus, socket) {
    socket.on('reconnect attempt', function () {
      if (global._auto_exit === true) {
        if (timestamp) process.stdout.write(_chalk["default"]['dim'](_chalk["default"].grey((0, _dayjs["default"])().format(timestamp) + ' ')));
        process.stdout.write(_chalk["default"].blue(pad(DEFAULT_PADDING, 'PM2') + ' | ') + '[[[ Target PM2 killed. ]]]');
        process.exit(0);
      }
    });
    var min_padding = 3;
    bus.on('log:*', function (type, packet) {
      if (id !== 'all' && packet.process.name != id && packet.process.pm_id != id) return;
      if (type === 'out' && exclusive === 'err' || type === 'err' && exclusive === 'out' || type === 'PM2' && exclusive !== false) return;
      var lines;
      if (typeof packet.data === 'string') lines = (packet.data || '').split('\n');else return;
      lines.forEach(function (line) {
        if (!line || line.length === 0) return;
        if (raw) return type === 'err' ? process.stderr.write(_util["default"].format(line) + '\n') : process.stdout.write(_util["default"].format(line) + '\n');
        if (timestamp) process.stdout.write(_chalk["default"]['dim'](_chalk["default"].grey((0, _dayjs["default"])().format(timestamp) + ' ')));
        var name = packet.process.pm_id + '|' + packet.process.name;
        if (name.length > min_padding) min_padding = name.length + 1;
        if (type === 'out') process.stdout.write(_chalk["default"].green(pad(' '.repeat(min_padding), name) + ' | '));else if (type === 'err') process.stdout.write(_chalk["default"].red(pad(' '.repeat(min_padding), name) + ' | '));else if (!raw && (id === 'all' || id === 'PM2')) process.stdout.write(_chalk["default"].blue(pad(' '.repeat(min_padding), 'PM2') + ' | '));
        if (highlight) process.stdout.write(_util["default"].format(line).replace(highlight, _chalk["default"].bgBlackBright(highlight)) + '\n');else process.stdout.write(_util["default"].format(line) + '\n');
      });
    });
  });
};

Log.devStream = function (Client, id, raw, timestamp, exclusive) {
  var that = this;
  Client.launchBus(function (err, bus) {
    setTimeout(function () {
      bus.on('process:event', function (packet) {
        if (packet.event == 'online') console.log(_chalk["default"].green('[rundev] App %s restarted'), packet.process.name);
      });
    }, 1000);
    var min_padding = 3;
    bus.on('log:*', function (type, packet) {
      if (id !== 'all' && packet.process.name != id && packet.process.pm_id != id) return;
      if (type === 'out' && exclusive === 'err' || type === 'err' && exclusive === 'out' || type === 'PM2' && exclusive !== false) return;
      if (type === 'PM2') return;
      var name = packet.process.pm_id + '|' + packet.process.name;
      var lines;
      if (typeof packet.data === 'string') lines = (packet.data || '').split('\n');else return;
      lines.forEach(function (line) {
        if (!line || line.length === 0) return;
        if (raw) return process.stdout.write(_util["default"].format(line) + '\n');
        if (timestamp) process.stdout.write(_chalk["default"]['dim'](_chalk["default"].grey((0, _dayjs["default"])().format(timestamp) + ' ')));
        var name = packet.process.name + '-' + packet.process.pm_id;
        if (name.length > min_padding) min_padding = name.length + 1;
        if (type === 'out') process.stdout.write(_chalk["default"].green(pad(' '.repeat(min_padding), name) + ' | '));else if (type === 'err') process.stdout.write(_chalk["default"].red(pad(' '.repeat(min_padding), name) + ' | '));else if (!raw && (id === 'all' || id === 'PM2')) process.stdout.write(_chalk["default"].blue(pad(' '.repeat(min_padding), 'PM2') + ' | '));
        process.stdout.write(_util["default"].format(line) + '\n');
      });
    });
  });
};

Log.jsonStream = function (Client, id) {
  var that = this;
  Client.launchBus(function (err, bus) {
    if (err) console.error(err);
    bus.on('process:event', function (packet) {
      process.stdout.write(JSON.stringify({
        timestamp: (0, _dayjs["default"])(packet.at),
        type: 'process_event',
        status: packet.event,
        app_name: packet.process.name
      }));
      process.stdout.write('\n');
    });
    bus.on('log:*', function (type, packet) {
      if (id !== 'all' && packet.process.name != id && packet.process.pm_id != id) return;
      if (type === 'PM2') return;
      if (typeof packet.data == 'string') packet.data = packet.data.replace(/(\r\n|\n|\r)/gm, '');
      process.stdout.write(JSON.stringify({
        message: packet.data,
        timestamp: (0, _dayjs["default"])(packet.at),
        type: type,
        process_id: packet.process.pm_id,
        app_name: packet.process.name
      }));
      process.stdout.write('\n');
    });
  });
};

Log.formatStream = function (Client, id, raw, timestamp, exclusive, highlight) {
  var that = this;
  Client.launchBus(function (err, bus) {
    bus.on('log:*', function (type, packet) {
      if (id !== 'all' && packet.process.name != id && packet.process.pm_id != id) return;
      if (type === 'out' && exclusive === 'err' || type === 'err' && exclusive === 'out' || type === 'PM2' && exclusive !== false) return;
      if (type === 'PM2' && raw) return;
      var name = packet.process.name + '-' + packet.process.pm_id;
      var lines;
      if (typeof packet.data === 'string') lines = (packet.data || '').split('\n');else return;
      lines.forEach(function (line) {
        if (!line || line.length === 0) return;

        if (!raw) {
          if (timestamp) process.stdout.write('timestamp=' + (0, _dayjs["default"])().format(timestamp) + ' ');
          if (packet.process.name === 'PM2') process.stdout.write('app=pm2 ');
          if (packet.process.name !== 'PM2') process.stdout.write('app=' + packet.process.name + ' id=' + packet.process.pm_id + ' ');
          if (type === 'out') process.stdout.write('type=out ');else if (type === 'err') process.stdout.write('type=error ');
        }

        process.stdout.write('message=');
        if (highlight) process.stdout.write(_util["default"].format(line).replace(highlight, _chalk["default"].bgBlackBright(highlight)) + '\n');else process.stdout.write(_util["default"].format(line) + '\n');
      });
    });
  });
};

function pad(pad, str, padLeft) {
  if (typeof str === 'undefined') return pad;

  if (padLeft) {
    return (pad + str).slice(-pad.length);
  } else {
    return (str + pad).substring(0, pad.length);
  }
}

var _default = Log;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9BUEkvTG9nLnRzIl0sIm5hbWVzIjpbIkxvZyIsIkRFRkFVTFRfUEFERElORyIsInRhaWwiLCJhcHBzX2xpc3QiLCJsaW5lcyIsInJhdyIsImNhbGxiYWNrIiwidGhhdCIsImxlbmd0aCIsImNvdW50IiwiZ2V0TGFzdExpbmVzIiwiZmlsZW5hbWUiLCJjaHVuayIsInNpemUiLCJNYXRoIiwibWF4IiwiZnMiLCJzdGF0U3luYyIsImNodW5rQXJyIiwiZmQiLCJjcmVhdGVSZWFkU3RyZWFtIiwic3RhcnQiLCJvbiIsImRhdGEiLCJ0b1N0cmluZyIsInNwbGl0Iiwic2xpY2UiLCJwb3AiLCJzb3J0IiwiYSIsImIiLCJleGlzdHNTeW5jIiwicGF0aCIsIm10aW1lIiwidmFsdWVPZiIsImFwcCIsIm5leHQiLCJvdXRwdXQiLCJjb25zb2xlIiwibG9nIiwiY2hhbGsiLCJncmV5IiwiZm9yRWFjaCIsIm91dCIsInR5cGUiLCJlcnJvciIsInByb2Nlc3MiLCJzdGRvdXQiLCJ3cml0ZSIsImdyZWVuIiwicGFkIiwiYXBwX25hbWUiLCJyZWQiLCJibHVlIiwic3RyZWFtIiwiQ2xpZW50IiwiaWQiLCJ0aW1lc3RhbXAiLCJleGNsdXNpdmUiLCJoaWdobGlnaHQiLCJsYXVuY2hCdXMiLCJlcnIiLCJidXMiLCJzb2NrZXQiLCJnbG9iYWwiLCJfYXV0b19leGl0IiwiZm9ybWF0IiwiZXhpdCIsIm1pbl9wYWRkaW5nIiwicGFja2V0IiwibmFtZSIsInBtX2lkIiwibGluZSIsInN0ZGVyciIsInV0aWwiLCJyZXBlYXQiLCJyZXBsYWNlIiwiYmdCbGFja0JyaWdodCIsImRldlN0cmVhbSIsInNldFRpbWVvdXQiLCJldmVudCIsImpzb25TdHJlYW0iLCJKU09OIiwic3RyaW5naWZ5IiwiYXQiLCJzdGF0dXMiLCJtZXNzYWdlIiwicHJvY2Vzc19pZCIsImZvcm1hdFN0cmVhbSIsInN0ciIsInBhZExlZnQiLCJzdWJzdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7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QyxHQUFsQixFQUF1QkMsT0FBdkIsRUFBaUM7QUFDL0IsTUFBSSxPQUFPRCxHQUFQLEtBQWUsV0FBbkIsRUFDRSxPQUFPdkMsR0FBUDs7QUFDRixNQUFJd0MsT0FBSixFQUFhO0FBQ1gsV0FBTyxDQUFDeEMsR0FBRyxHQUFHdUMsR0FBUCxFQUFZL0QsS0FBWixDQUFrQixDQUFDd0IsR0FBRyxDQUFDMUMsTUFBdkIsQ0FBUDtBQUNELEdBRkQsTUFFTztBQUNMLFdBQU8sQ0FBQ2lGLEdBQUcsR0FBR3ZDLEdBQVAsRUFBWXlDLFNBQVosQ0FBc0IsQ0FBdEIsRUFBeUJ6QyxHQUFHLENBQUMxQyxNQUE3QixDQUFQO0FBQ0Q7QUFDRjs7ZUFFY1IsRyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IDIwMTMgdGhlIFBNMiBwcm9qZWN0IGF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIGxpY2Vuc2UgdGhhdFxuICogY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuXG4gKi9cbmltcG9ydCBmcyAgICAgZnJvbSAnZnMnO1xuaW1wb3J0ICAgIHV0aWwgICBmcm9tICd1dGlsJztcbmltcG9ydCAgICBjaGFsayAgZnJvbSAnY2hhbGsnO1xuaW1wb3J0ICAgIGZvckVhY2hMaW1pdCAgZnJvbSAnYXN5bmMvZm9yRWFjaExpbWl0JztcbmltcG9ydCAgICBkYXlqcyBmcm9tICdkYXlqcyc7XG5cbnZhciBMb2c6IGFueSA9IHt9O1xuXG52YXIgREVGQVVMVF9QQURESU5HID0gJyAgICAgICAgICAnO1xuXG4vKipcbiAqIFRhaWwgbG9ncyBmcm9tIGZpbGUgc3RyZWFtLlxuICogQHBhcmFtIHtPYmplY3R9IGFwcHNfbGlzdFxuICogQHBhcmFtIHtOdW1iZXJ9IGxpbmVzXG4gKiBAcGFyYW0ge0Jvb2xlYW59IHJhd1xuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAqIEByZXR1cm5cbiAqL1xuXG5Mb2cudGFpbCA9IGZ1bmN0aW9uKGFwcHNfbGlzdCwgbGluZXMsIHJhdywgY2FsbGJhY2spIHtcbiAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gIGlmIChsaW5lcyA9PT0gMCB8fCBhcHBzX2xpc3QubGVuZ3RoID09PSAwKVxuICAgIHJldHVybiBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuXG4gIHZhciBjb3VudCA9IDA7XG5cbiAgdmFyIGdldExhc3RMaW5lcyA9IGZ1bmN0aW9uIChmaWxlbmFtZSwgbGluZXMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGNodW5rID0gJyc7XG4gICAgdmFyIHNpemUgPSBNYXRoLm1heCgwLCBmcy5zdGF0U3luYyhmaWxlbmFtZSkuc2l6ZSAtIChsaW5lcyAqIDIwMCkpO1xuXG4gICAgbGV0IGNodW5rQXJyO1xuICAgIHZhciBmZCA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0oZmlsZW5hbWUsIHtzdGFydCA6IHNpemV9KTtcbiAgICBmZC5vbignZGF0YScsIGZ1bmN0aW9uKGRhdGEpIHsgY2h1bmsgKz0gZGF0YS50b1N0cmluZygpOyB9KTtcbiAgICBmZC5vbignZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICBjaHVua0FyciA9IGNodW5rLnNwbGl0KCdcXG4nKS5zbGljZSgtKGxpbmVzKzEpKTtcbiAgICAgIGNodW5rQXJyLnBvcCgpO1xuICAgICAgY2FsbGJhY2soY2h1bmtBcnIpO1xuICAgIH0pO1xuICB9O1xuXG4gIGFwcHNfbGlzdC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICByZXR1cm4gKGZzLmV4aXN0c1N5bmMoYS5wYXRoKSA/IGZzLnN0YXRTeW5jKGEucGF0aCkubXRpbWUudmFsdWVPZigpIDogMCkgLVxuICAgICAgKGZzLmV4aXN0c1N5bmMoYi5wYXRoKSA/IGZzLnN0YXRTeW5jKGIucGF0aCkubXRpbWUudmFsdWVPZigpIDogMCk7XG4gIH0pO1xuXG4gIGZvckVhY2hMaW1pdChhcHBzX2xpc3QsIDEsIGZ1bmN0aW9uKGFwcCwgbmV4dCkge1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhhcHAucGF0aCB8fCAnJykpXG4gICAgICByZXR1cm4gbmV4dCgpO1xuXG4gICAgZ2V0TGFzdExpbmVzKGFwcC5wYXRoLCBsaW5lcywgZnVuY3Rpb24ob3V0cHV0KSB7XG4gICAgICBjb25zb2xlLmxvZyhjaGFsay5ncmV5KCclcyBsYXN0ICVkIGxpbmVzOicpLCBhcHAucGF0aCwgbGluZXMpO1xuICAgICAgb3V0cHV0LmZvckVhY2goZnVuY3Rpb24ob3V0KSB7XG4gICAgICAgIGlmIChyYXcpXG4gICAgICAgICAgcmV0dXJuIGFwcC50eXBlID09PSAnZXJyJyA/IGNvbnNvbGUuZXJyb3Iob3V0KSA6IGNvbnNvbGUubG9nKG91dCk7XG4gICAgICAgIGlmIChhcHAudHlwZSA9PT0gJ291dCcpXG4gICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoY2hhbGsuZ3JlZW4ocGFkKERFRkFVTFRfUEFERElORywgYXBwLmFwcF9uYW1lKSAgKyAnIHwgJykpO1xuICAgICAgICBlbHNlIGlmIChhcHAudHlwZSA9PT0gJ2VycicpXG4gICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoY2hhbGsucmVkKHBhZChERUZBVUxUX1BBRERJTkcsIGFwcC5hcHBfbmFtZSkgICsgJyB8ICcpKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGNoYWxrLmJsdWUocGFkKERFRkFVTFRfUEFERElORywgJ1BNMicpICsgJyB8ICcpKTtcbiAgICAgICAgY29uc29sZS5sb2cob3V0KTtcbiAgICAgIH0pO1xuICAgICAgaWYgKG91dHB1dC5sZW5ndGgpXG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCdcXG4nKTtcbiAgICAgIG5leHQoKTtcbiAgICB9KTtcbiAgfSwgZnVuY3Rpb24oKSB7XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIFN0cmVhbSBsb2dzIGluIHJlYWx0aW1lIGZyb20gdGhlIGJ1cyBldmVudGVtaXR0ZXIuXG4gKiBAcGFyYW0ge1N0cmluZ30gaWRcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gcmF3XG4gKiBAcmV0dXJuXG4gKi9cblxuTG9nLnN0cmVhbSA9IGZ1bmN0aW9uKENsaWVudCwgaWQsIHJhdywgdGltZXN0YW1wLCBleGNsdXNpdmUsIGhpZ2hsaWdodCkge1xuICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgQ2xpZW50LmxhdW5jaEJ1cyhmdW5jdGlvbihlcnIsIGJ1cywgc29ja2V0KSB7XG5cbiAgICBzb2NrZXQub24oJ3JlY29ubmVjdCBhdHRlbXB0JywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoKGdsb2JhbCBhcyBhbnkpLl9hdXRvX2V4aXQgPT09IHRydWUpIHtcbiAgICAgICAgaWYgKHRpbWVzdGFtcClcbiAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShjaGFsa1snZGltJ10oY2hhbGsuZ3JleShkYXlqcygpLmZvcm1hdCh0aW1lc3RhbXApICsgJyAnKSkpO1xuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShjaGFsay5ibHVlKHBhZChERUZBVUxUX1BBRERJTkcsICdQTTInKSArICcgfCAnKSArICdbW1sgVGFyZ2V0IFBNMiBraWxsZWQuIF1dXScpO1xuICAgICAgICBwcm9jZXNzLmV4aXQoMCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgbWluX3BhZGRpbmcgPSAzXG5cbiAgICBidXMub24oJ2xvZzoqJywgZnVuY3Rpb24odHlwZSwgcGFja2V0KSB7XG4gICAgICBpZiAoaWQgIT09ICdhbGwnXG4gICAgICAgICAgJiYgcGFja2V0LnByb2Nlc3MubmFtZSAhPSBpZFxuICAgICAgICAgICYmIHBhY2tldC5wcm9jZXNzLnBtX2lkICE9IGlkKVxuICAgICAgICByZXR1cm47XG5cbiAgICAgIGlmICgodHlwZSA9PT0gJ291dCcgJiYgZXhjbHVzaXZlID09PSAnZXJyJylcbiAgICAgICAgIHx8ICh0eXBlID09PSAnZXJyJyAmJiBleGNsdXNpdmUgPT09ICdvdXQnKVxuICAgICAgICAgfHwgKHR5cGUgPT09ICdQTTInICYmIGV4Y2x1c2l2ZSAhPT0gZmFsc2UpKVxuICAgICAgICByZXR1cm47XG5cbiAgICAgIHZhciBsaW5lcztcblxuICAgICAgaWYgKHR5cGVvZihwYWNrZXQuZGF0YSkgPT09ICdzdHJpbmcnKVxuICAgICAgICBsaW5lcyA9IChwYWNrZXQuZGF0YSB8fCAnJykuc3BsaXQoJ1xcbicpO1xuICAgICAgZWxzZVxuICAgICAgICByZXR1cm47XG5cbiAgICAgIGxpbmVzLmZvckVhY2goZnVuY3Rpb24obGluZSkge1xuICAgICAgICBpZiAoIWxpbmUgfHwgbGluZS5sZW5ndGggPT09IDApIHJldHVybjtcblxuICAgICAgICBpZiAocmF3KVxuICAgICAgICAgIHJldHVybiB0eXBlID09PSAnZXJyJyA/IHByb2Nlc3Muc3RkZXJyLndyaXRlKHV0aWwuZm9ybWF0KGxpbmUpICsgJ1xcbicpIDogcHJvY2Vzcy5zdGRvdXQud3JpdGUodXRpbC5mb3JtYXQobGluZSkgKyAnXFxuJyk7XG5cbiAgICAgICAgaWYgKHRpbWVzdGFtcClcbiAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShjaGFsa1snZGltJ10oY2hhbGsuZ3JleShkYXlqcygpLmZvcm1hdCh0aW1lc3RhbXApICsgJyAnKSkpO1xuXG4gICAgICAgIHZhciBuYW1lID0gcGFja2V0LnByb2Nlc3MucG1faWQgKyAnfCcgKyBwYWNrZXQucHJvY2Vzcy5uYW1lO1xuXG4gICAgICAgIGlmIChuYW1lLmxlbmd0aCA+IG1pbl9wYWRkaW5nKVxuICAgICAgICAgIG1pbl9wYWRkaW5nID0gbmFtZS5sZW5ndGggKyAxXG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdvdXQnKVxuICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGNoYWxrLmdyZWVuKHBhZCgnICcucmVwZWF0KG1pbl9wYWRkaW5nKSwgbmFtZSkgICsgJyB8ICcpKTtcbiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2VycicpXG4gICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoY2hhbGsucmVkKHBhZCgnICcucmVwZWF0KG1pbl9wYWRkaW5nKSwgbmFtZSkgICsgJyB8ICcpKTtcbiAgICAgICAgZWxzZSBpZiAoIXJhdyAmJiAoaWQgPT09ICdhbGwnIHx8IGlkID09PSAnUE0yJykpXG4gICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoY2hhbGsuYmx1ZShwYWQoJyAnLnJlcGVhdChtaW5fcGFkZGluZyksICdQTTInKSArICcgfCAnKSk7XG4gICAgICAgIGlmIChoaWdobGlnaHQpXG4gICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUodXRpbC5mb3JtYXQobGluZSkucmVwbGFjZShoaWdobGlnaHQsIGNoYWxrLmJnQmxhY2tCcmlnaHQoaGlnaGxpZ2h0KSkgKyAnXFxuJyk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZSh1dGlsLmZvcm1hdChsaW5lKSsgJ1xcbicpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuTG9nLmRldlN0cmVhbSA9IGZ1bmN0aW9uKENsaWVudCwgaWQsIHJhdywgdGltZXN0YW1wLCBleGNsdXNpdmUpIHtcbiAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gIENsaWVudC5sYXVuY2hCdXMoZnVuY3Rpb24oZXJyLCBidXMpIHtcblxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBidXMub24oJ3Byb2Nlc3M6ZXZlbnQnLCBmdW5jdGlvbihwYWNrZXQpIHtcbiAgICAgICAgaWYgKHBhY2tldC5ldmVudCA9PSAnb25saW5lJylcbiAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5ncmVlbignW3J1bmRldl0gQXBwICVzIHJlc3RhcnRlZCcpLCBwYWNrZXQucHJvY2Vzcy5uYW1lKTtcbiAgICAgIH0pO1xuICAgIH0sIDEwMDApO1xuXG4gICAgdmFyIG1pbl9wYWRkaW5nID0gM1xuXG4gICAgYnVzLm9uKCdsb2c6KicsIGZ1bmN0aW9uKHR5cGUsIHBhY2tldCkge1xuICAgICAgaWYgKGlkICE9PSAnYWxsJ1xuICAgICAgICAgICYmIHBhY2tldC5wcm9jZXNzLm5hbWUgIT0gaWRcbiAgICAgICAgICAmJiBwYWNrZXQucHJvY2Vzcy5wbV9pZCAhPSBpZClcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICBpZiAoKHR5cGUgPT09ICdvdXQnICYmIGV4Y2x1c2l2ZSA9PT0gJ2VycicpXG4gICAgICAgICAgfHwgKHR5cGUgPT09ICdlcnInICYmIGV4Y2x1c2l2ZSA9PT0gJ291dCcpXG4gICAgICAgICAgfHwgKHR5cGUgPT09ICdQTTInICYmIGV4Y2x1c2l2ZSAhPT0gZmFsc2UpKVxuICAgICAgICByZXR1cm47XG5cbiAgICAgIGlmICh0eXBlID09PSAnUE0yJylcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICB2YXIgbmFtZSA9IHBhY2tldC5wcm9jZXNzLnBtX2lkICsgJ3wnICsgcGFja2V0LnByb2Nlc3MubmFtZTtcblxuICAgICAgdmFyIGxpbmVzO1xuXG4gICAgICBpZiAodHlwZW9mKHBhY2tldC5kYXRhKSA9PT0gJ3N0cmluZycpXG4gICAgICAgIGxpbmVzID0gKHBhY2tldC5kYXRhIHx8ICcnKS5zcGxpdCgnXFxuJyk7XG4gICAgICBlbHNlXG4gICAgICAgIHJldHVybjtcblxuICAgICAgbGluZXMuZm9yRWFjaChmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgIGlmICghbGluZSB8fCBsaW5lLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgICAgIGlmIChyYXcpXG4gICAgICAgICAgcmV0dXJuIHByb2Nlc3Muc3Rkb3V0LndyaXRlKHV0aWwuZm9ybWF0KGxpbmUpICsgJ1xcbicpO1xuXG4gICAgICAgIGlmICh0aW1lc3RhbXApXG4gICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoY2hhbGtbJ2RpbSddKGNoYWxrLmdyZXkoZGF5anMoKS5mb3JtYXQodGltZXN0YW1wKSArICcgJykpKTtcblxuICAgICAgICB2YXIgbmFtZSA9IHBhY2tldC5wcm9jZXNzLm5hbWUgKyAnLScgKyBwYWNrZXQucHJvY2Vzcy5wbV9pZDtcblxuICAgICAgICBpZiAobmFtZS5sZW5ndGggPiBtaW5fcGFkZGluZylcbiAgICAgICAgICBtaW5fcGFkZGluZyA9IG5hbWUubGVuZ3RoICsgMVxuXG4gICAgICAgIGlmICh0eXBlID09PSAnb3V0JylcbiAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShjaGFsay5ncmVlbihwYWQoJyAnLnJlcGVhdChtaW5fcGFkZGluZyksIG5hbWUpICArICcgfCAnKSk7XG4gICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdlcnInKVxuICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGNoYWxrLnJlZChwYWQoJyAnLnJlcGVhdChtaW5fcGFkZGluZyksIG5hbWUpICArICcgfCAnKSk7XG4gICAgICAgIGVsc2UgaWYgKCFyYXcgJiYgKGlkID09PSAnYWxsJyB8fCBpZCA9PT0gJ1BNMicpKVxuICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGNoYWxrLmJsdWUocGFkKCcgJy5yZXBlYXQobWluX3BhZGRpbmcpLCAnUE0yJykgKyAnIHwgJykpO1xuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZSh1dGlsLmZvcm1hdChsaW5lKSArICdcXG4nKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbkxvZy5qc29uU3RyZWFtID0gZnVuY3Rpb24oQ2xpZW50LCBpZCkge1xuICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgQ2xpZW50LmxhdW5jaEJ1cyhmdW5jdGlvbihlcnIsIGJ1cykge1xuICAgIGlmIChlcnIpIGNvbnNvbGUuZXJyb3IoZXJyKTtcblxuICAgIGJ1cy5vbigncHJvY2VzczpldmVudCcsIGZ1bmN0aW9uKHBhY2tldCkge1xuICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB0aW1lc3RhbXAgOiBkYXlqcyhwYWNrZXQuYXQpLFxuICAgICAgICB0eXBlICAgICAgOiAncHJvY2Vzc19ldmVudCcsXG4gICAgICAgIHN0YXR1cyAgICA6IHBhY2tldC5ldmVudCxcbiAgICAgICAgYXBwX25hbWUgIDogcGFja2V0LnByb2Nlc3MubmFtZVxuICAgICAgfSkpO1xuICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoJ1xcbicpO1xuICAgIH0pO1xuXG4gICAgYnVzLm9uKCdsb2c6KicsIGZ1bmN0aW9uKHR5cGUsIHBhY2tldCkge1xuICAgICAgaWYgKGlkICE9PSAnYWxsJ1xuICAgICAgICAgICYmIHBhY2tldC5wcm9jZXNzLm5hbWUgIT0gaWRcbiAgICAgICAgICAmJiBwYWNrZXQucHJvY2Vzcy5wbV9pZCAhPSBpZClcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICBpZiAodHlwZSA9PT0gJ1BNMicpXG4gICAgICAgIHJldHVybjtcblxuICAgICAgaWYgKHR5cGVvZihwYWNrZXQuZGF0YSkgPT0gJ3N0cmluZycpXG4gICAgICAgIHBhY2tldC5kYXRhID0gcGFja2V0LmRhdGEucmVwbGFjZSgvKFxcclxcbnxcXG58XFxyKS9nbSwnJyk7XG5cbiAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbWVzc2FnZSA6IHBhY2tldC5kYXRhLFxuICAgICAgICB0aW1lc3RhbXAgOiBkYXlqcyhwYWNrZXQuYXQpLFxuICAgICAgICB0eXBlIDogdHlwZSxcbiAgICAgICAgcHJvY2Vzc19pZCA6IHBhY2tldC5wcm9jZXNzLnBtX2lkLFxuICAgICAgICBhcHBfbmFtZSA6IHBhY2tldC5wcm9jZXNzLm5hbWVcbiAgICAgIH0pKTtcbiAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCdcXG4nKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5Mb2cuZm9ybWF0U3RyZWFtID0gZnVuY3Rpb24oQ2xpZW50LCBpZCwgcmF3LCB0aW1lc3RhbXAsIGV4Y2x1c2l2ZSwgaGlnaGxpZ2h0KSB7XG4gIHZhciB0aGF0ID0gdGhpcztcblxuICBDbGllbnQubGF1bmNoQnVzKGZ1bmN0aW9uKGVyciwgYnVzKSB7XG5cbiAgICBidXMub24oJ2xvZzoqJywgZnVuY3Rpb24odHlwZSwgcGFja2V0KSB7XG4gICAgICBpZiAoaWQgIT09ICdhbGwnXG4gICAgICAgICAgJiYgcGFja2V0LnByb2Nlc3MubmFtZSAhPSBpZFxuICAgICAgICAgICYmIHBhY2tldC5wcm9jZXNzLnBtX2lkICE9IGlkKVxuICAgICAgICByZXR1cm47XG5cbiAgICAgIGlmICgodHlwZSA9PT0gJ291dCcgJiYgZXhjbHVzaXZlID09PSAnZXJyJylcbiAgICAgICAgICB8fCAodHlwZSA9PT0gJ2VycicgJiYgZXhjbHVzaXZlID09PSAnb3V0JylcbiAgICAgICAgICB8fCAodHlwZSA9PT0gJ1BNMicgJiYgZXhjbHVzaXZlICE9PSBmYWxzZSkpXG4gICAgICAgIHJldHVybjtcblxuICAgICAgaWYgKHR5cGUgPT09ICdQTTInICYmIHJhdylcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICB2YXIgbmFtZSA9IHBhY2tldC5wcm9jZXNzLm5hbWUgKyAnLScgKyBwYWNrZXQucHJvY2Vzcy5wbV9pZDtcblxuICAgICAgdmFyIGxpbmVzO1xuXG4gICAgICBpZiAodHlwZW9mKHBhY2tldC5kYXRhKSA9PT0gJ3N0cmluZycpXG4gICAgICAgIGxpbmVzID0gKHBhY2tldC5kYXRhIHx8ICcnKS5zcGxpdCgnXFxuJyk7XG4gICAgICBlbHNlXG4gICAgICAgIHJldHVybjtcblxuICAgICAgbGluZXMuZm9yRWFjaChmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgIGlmICghbGluZSB8fCBsaW5lLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gICAgICAgIGlmICghcmF3KSB7XG4gICAgICAgICAgaWYgKHRpbWVzdGFtcClcbiAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCd0aW1lc3RhbXA9JyArIGRheWpzKCkuZm9ybWF0KHRpbWVzdGFtcCkgKyAnICcpO1xuICAgICAgICAgIGlmIChwYWNrZXQucHJvY2Vzcy5uYW1lID09PSAnUE0yJylcbiAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCdhcHA9cG0yICcpO1xuICAgICAgICAgIGlmIChwYWNrZXQucHJvY2Vzcy5uYW1lICE9PSAnUE0yJylcbiAgICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKCdhcHA9JyArIHBhY2tldC5wcm9jZXNzLm5hbWUgKyAnIGlkPScgKyBwYWNrZXQucHJvY2Vzcy5wbV9pZCArICcgJyk7XG4gICAgICAgICAgaWYgKHR5cGUgPT09ICdvdXQnKVxuICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoJ3R5cGU9b3V0ICcpO1xuICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdlcnInKVxuICAgICAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUoJ3R5cGU9ZXJyb3IgJyk7XG4gICAgICAgIH1cblxuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZSgnbWVzc2FnZT0nKTtcbiAgICAgICAgaWYgKGhpZ2hsaWdodClcbiAgICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZSh1dGlsLmZvcm1hdChsaW5lKS5yZXBsYWNlKGhpZ2hsaWdodCwgY2hhbGsuYmdCbGFja0JyaWdodChoaWdobGlnaHQpKSArICdcXG4nKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKHV0aWwuZm9ybWF0KGxpbmUpICsgJ1xcbicpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuZnVuY3Rpb24gcGFkKHBhZCwgc3RyLCBwYWRMZWZ0Pykge1xuICBpZiAodHlwZW9mIHN0ciA9PT0gJ3VuZGVmaW5lZCcpXG4gICAgcmV0dXJuIHBhZDtcbiAgaWYgKHBhZExlZnQpIHtcbiAgICByZXR1cm4gKHBhZCArIHN0cikuc2xpY2UoLXBhZC5sZW5ndGgpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAoc3RyICsgcGFkKS5zdWJzdHJpbmcoMCwgcGFkLmxlbmd0aCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTG9nO1xuIl19