"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = _default;

var _constants = _interopRequireDefault(require("../../../constants"));

var _Common = _interopRequireDefault(require("../../Common"));

var _Modularizer = _interopRequireDefault(require("./Modularizer"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/***************************
 *
 * Module methods
 *
 **************************/
function _default(CLI) {
  /**
   * Install / Update a module
   */
  CLI.prototype.install = function (module_name, opts, cb) {
    var that = this;

    if (typeof opts == 'function') {
      cb = opts;
      opts = {};
    }

    _Modularizer["default"].install(this, module_name, opts, function (err, data) {
      if (err) {
        _Common["default"].printError(_constants["default"].PREFIX_MSG_ERR + (err.message || err));

        return cb ? cb(_Common["default"].retErr(err)) : that.speedList(_constants["default"].ERROR_EXIT);
      }

      return cb ? cb(null, data) : that.speedList(_constants["default"].SUCCESS_EXIT);
    });
  };
  /**
   * Uninstall a module
   */


  CLI.prototype.uninstall = function (module_name, cb) {
    var that = this;

    _Modularizer["default"].uninstall(this, module_name, function (err, data) {
      if (err) return cb ? cb(_Common["default"].retErr(err)) : that.speedList(_constants["default"].ERROR_EXIT);
      return cb ? cb(null, data) : that.speedList(_constants["default"].SUCCESS_EXIT);
    });
  };

  CLI.prototype.launchAll = function (CLI, cb) {
    _Modularizer["default"].launchModules(CLI, cb);
  };

  CLI.prototype["package"] = function (module_path, cb) {
    var _this = this;

    _Modularizer["default"]["package"](this, module_path, function (err, res) {
      if (err) {
        _Common["default"].errMod(err);

        return cb ? cb(err) : _this.exitCli(1);
      }

      _Common["default"].logMod("Module packaged in ".concat(res.path));

      return cb ? cb(err) : _this.exitCli(0);
    });
  };
  /**
   * Publish module on NPM + Git push
   */


  CLI.prototype.publish = function (folder, opts, cb) {
    var that = this;

    _Modularizer["default"].publish(this, folder, opts, function (err, data) {
      if (err) return cb ? cb(_Common["default"].retErr(err)) : that.speedList(_constants["default"].ERROR_EXIT);
      return cb ? cb(null, data) : that.speedList(_constants["default"].SUCCESS_EXIT);
    });
  };
  /**
   * Publish module on NPM + Git push
   */


  CLI.prototype.generateModuleSample = function (app_name, cb) {
    var that = this;

    _Modularizer["default"].generateSample(app_name, function (err, data) {
      if (err) return cb ? cb(_Common["default"].retErr(err)) : that.exitCli(_constants["default"].ERROR_EXIT);
      return cb ? cb(null, data) : that.exitCli(_constants["default"].SUCCESS_EXIT);
    });
  };
  /**
   * Special delete method
   */


  CLI.prototype.deleteModule = function (module_name, cb) {
    var that = this;
    var found_proc = [];
    this.Client.getAllProcess(function (err, procs) {
      if (err) {
        _Common["default"].printError('Error retrieving process list: ' + err);

        return cb(_Common["default"].retErr(err));
      }

      procs.forEach(function (proc) {
        if (proc.pm2_env.name == module_name && proc.pm2_env.pmx_module) {
          found_proc.push(proc.pm_id);
        }
      });
      if (found_proc.length == 0) return cb();

      that._operate('deleteProcessId', found_proc[0], function (err) {
        if (err) return cb(_Common["default"].retErr(err));

        _Common["default"].printOut('In memory process deleted');

        return cb();
      });
    });
  };
}

;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BUEkvTW9kdWxlcy9pbmRleC50cyJdLCJuYW1lcyI6WyJDTEkiLCJwcm90b3R5cGUiLCJpbnN0YWxsIiwibW9kdWxlX25hbWUiLCJvcHRzIiwiY2IiLCJ0aGF0IiwiTW9kdWxhcml6ZXIiLCJlcnIiLCJkYXRhIiwiQ29tbW9uIiwicHJpbnRFcnJvciIsImNzdCIsIlBSRUZJWF9NU0dfRVJSIiwibWVzc2FnZSIsInJldEVyciIsInNwZWVkTGlzdCIsIkVSUk9SX0VYSVQiLCJTVUNDRVNTX0VYSVQiLCJ1bmluc3RhbGwiLCJsYXVuY2hBbGwiLCJsYXVuY2hNb2R1bGVzIiwibW9kdWxlX3BhdGgiLCJyZXMiLCJlcnJNb2QiLCJleGl0Q2xpIiwibG9nTW9kIiwicGF0aCIsInB1Ymxpc2giLCJmb2xkZXIiLCJnZW5lcmF0ZU1vZHVsZVNhbXBsZSIsImFwcF9uYW1lIiwiZ2VuZXJhdGVTYW1wbGUiLCJkZWxldGVNb2R1bGUiLCJmb3VuZF9wcm9jIiwiQ2xpZW50IiwiZ2V0QWxsUHJvY2VzcyIsInByb2NzIiwiZm9yRWFjaCIsInByb2MiLCJwbTJfZW52IiwibmFtZSIsInBteF9tb2R1bGUiLCJwdXNoIiwicG1faWQiLCJsZW5ndGgiLCJfb3BlcmF0ZSIsInByaW50T3V0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBT0E7O0FBQ0E7O0FBSUE7Ozs7QUFYQTs7Ozs7QUFhZSxrQkFBU0EsR0FBVCxFQUFjO0FBQzNCOzs7QUFHQUEsRUFBQUEsR0FBRyxDQUFDQyxTQUFKLENBQWNDLE9BQWQsR0FBd0IsVUFBU0MsV0FBVCxFQUFzQkMsSUFBdEIsRUFBNEJDLEVBQTVCLEVBQWdDO0FBQ3RELFFBQUlDLElBQUksR0FBRyxJQUFYOztBQUVBLFFBQUksT0FBT0YsSUFBUCxJQUFnQixVQUFwQixFQUFnQztBQUM5QkMsTUFBQUEsRUFBRSxHQUFHRCxJQUFMO0FBQ0FBLE1BQUFBLElBQUksR0FBRyxFQUFQO0FBQ0Q7O0FBRURHLDRCQUFZTCxPQUFaLENBQW9C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O0FBQzNCLFlBQUlBLElBQUksQ0FBQ0MsT0FBTCxDQUFhQyxJQUFiLElBQXFCdEMsV0FBckIsSUFBb0NvQyxJQUFJLENBQUNDLE9BQUwsQ0FBYUUsVUFBckQsRUFBaUU7QUFDL0RSLFVBQUFBLFVBQVUsQ0FBQ1MsSUFBWCxDQUFnQkosSUFBSSxDQUFDSyxLQUFyQjtBQUNEO0FBQ0YsT0FKRDtBQU1BLFVBQUlWLFVBQVUsQ0FBQ1csTUFBWCxJQUFxQixDQUF6QixFQUNFLE9BQU94QyxFQUFFLEVBQVQ7O0FBRUZDLE1BQUFBLElBQUksQ0FBQ3dDLFFBQUwsQ0FBYyxpQkFBZCxFQUFpQ1osVUFBVSxDQUFDLENBQUQsQ0FBM0MsRUFBZ0QsVUFBUzFCLEdBQVQsRUFBYztBQUM1RCxZQUFJQSxHQUFKLEVBQVMsT0FBT0gsRUFBRSxDQUFDSyxtQkFBT0ssTUFBUCxDQUFjUCxHQUFkLENBQUQsQ0FBVDs7QUFDVEUsMkJBQU9xQyxRQUFQLENBQWdCLDJCQUFoQjs7QUFDQSxlQUFPMUMsRUFBRSxFQUFUO0FBQ0QsT0FKRDtBQUtELEtBcEJEO0FBcUJELEdBMUJEO0FBMkJEOztBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICpcclxuICogTW9kdWxlIG1ldGhvZHNcclxuICpcclxuICoqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxuaW1wb3J0IGNzdCAgICAgICAgICAgZnJvbSAnLi4vLi4vLi4vY29uc3RhbnRzJztcclxuaW1wb3J0IENvbW1vbiAgICAgICBmcm9tICcuLi8uLi9Db21tb24nO1xyXG5pbXBvcnQgY2hhbGsgICAgICAgICBmcm9tICdjaGFsayc7XHJcbmltcG9ydCBmb3JFYWNoTGltaXQgIGZyb20gJ2FzeW5jL2ZvckVhY2hMaW1pdCc7XHJcblxyXG5pbXBvcnQgTW9kdWxhcml6ZXIgZnJvbSAnLi9Nb2R1bGFyaXplcic7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbihDTEkpIHtcclxuICAvKipcclxuICAgKiBJbnN0YWxsIC8gVXBkYXRlIGEgbW9kdWxlXHJcbiAgICovXHJcbiAgQ0xJLnByb3RvdHlwZS5pbnN0YWxsID0gZnVuY3Rpb24obW9kdWxlX25hbWUsIG9wdHMsIGNiKSB7XHJcbiAgICB2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgaWYgKHR5cGVvZihvcHRzKSA9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNiID0gb3B0cztcclxuICAgICAgb3B0cyA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgIE1vZHVsYXJpemVyLmluc3RhbGwodGhpcywgbW9kdWxlX25hbWUsIG9wdHMsIGZ1bmN0aW9uKGVyciwgZGF0YSkge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgQ29tbW9uLnByaW50RXJyb3IoY3N0LlBSRUZJWF9NU0dfRVJSICsgKGVyci5tZXNzYWdlIHx8IGVycikpO1xyXG4gICAgICAgIHJldHVybiBjYiA/IGNiKENvbW1vbi5yZXRFcnIoZXJyKSkgOiB0aGF0LnNwZWVkTGlzdChjc3QuRVJST1JfRVhJVCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGNiID8gY2IobnVsbCwgZGF0YSkgOiB0aGF0LnNwZWVkTGlzdChjc3QuU1VDQ0VTU19FWElUKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIFVuaW5zdGFsbCBhIG1vZHVsZVxyXG4gICAqL1xyXG4gIENMSS5wcm90b3R5cGUudW5pbnN0YWxsID0gZnVuY3Rpb24obW9kdWxlX25hbWUsIGNiKSB7XHJcbiAgICB2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgTW9kdWxhcml6ZXIudW5pbnN0YWxsKHRoaXMsIG1vZHVsZV9uYW1lLCBmdW5jdGlvbihlcnIsIGRhdGEpIHtcclxuICAgICAgaWYgKGVycilcclxuICAgICAgICByZXR1cm4gY2IgPyBjYihDb21tb24ucmV0RXJyKGVycikpIDogdGhhdC5zcGVlZExpc3QoY3N0LkVSUk9SX0VYSVQpO1xyXG4gICAgICByZXR1cm4gY2IgPyBjYihudWxsLCBkYXRhKSA6IHRoYXQuc3BlZWRMaXN0KGNzdC5TVUNDRVNTX0VYSVQpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgQ0xJLnByb3RvdHlwZS5sYXVuY2hBbGwgPSBmdW5jdGlvbihDTEksIGNiKSB7XHJcbiAgICBNb2R1bGFyaXplci5sYXVuY2hNb2R1bGVzKENMSSwgY2IpO1xyXG4gIH07XHJcblxyXG4gIENMSS5wcm90b3R5cGUucGFja2FnZSA9IGZ1bmN0aW9uKG1vZHVsZV9wYXRoLCBjYikge1xyXG4gICAgTW9kdWxhcml6ZXIucGFja2FnZSh0aGlzLCBtb2R1bGVfcGF0aCwgKGVyciwgcmVzKSA9PiB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBDb21tb24uZXJyTW9kKGVycilcclxuICAgICAgICByZXR1cm4gY2IgPyBjYihlcnIpIDogdGhpcy5leGl0Q2xpKDEpXHJcbiAgICAgIH1cclxuICAgICAgQ29tbW9uLmxvZ01vZChgTW9kdWxlIHBhY2thZ2VkIGluICR7cmVzLnBhdGh9YClcclxuICAgICAgcmV0dXJuIGNiID8gY2IoZXJyKSA6IHRoaXMuZXhpdENsaSgwKVxyXG4gICAgfSlcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBQdWJsaXNoIG1vZHVsZSBvbiBOUE0gKyBHaXQgcHVzaFxyXG4gICAqL1xyXG4gIENMSS5wcm90b3R5cGUucHVibGlzaCA9IGZ1bmN0aW9uKGZvbGRlciwgb3B0cywgY2IpIHtcclxuICAgIHZhciB0aGF0ID0gdGhpcztcclxuXHJcbiAgICBNb2R1bGFyaXplci5wdWJsaXNoKHRoaXMsIGZvbGRlciwgb3B0cywgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XHJcbiAgICAgIGlmIChlcnIpXHJcbiAgICAgICAgcmV0dXJuIGNiID8gY2IoQ29tbW9uLnJldEVycihlcnIpKSA6IHRoYXQuc3BlZWRMaXN0KGNzdC5FUlJPUl9FWElUKTtcclxuICAgICAgcmV0dXJuIGNiID8gY2IobnVsbCwgZGF0YSkgOiB0aGF0LnNwZWVkTGlzdChjc3QuU1VDQ0VTU19FWElUKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIFB1Ymxpc2ggbW9kdWxlIG9uIE5QTSArIEdpdCBwdXNoXHJcbiAgICovXHJcbiAgQ0xJLnByb3RvdHlwZS5nZW5lcmF0ZU1vZHVsZVNhbXBsZSA9IGZ1bmN0aW9uKGFwcF9uYW1lLCBjYikge1xyXG4gICAgdmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuICAgIE1vZHVsYXJpemVyLmdlbmVyYXRlU2FtcGxlKGFwcF9uYW1lLCBmdW5jdGlvbihlcnIsIGRhdGEpIHtcclxuICAgICAgaWYgKGVycilcclxuICAgICAgICByZXR1cm4gY2IgPyBjYihDb21tb24ucmV0RXJyKGVycikpIDogdGhhdC5leGl0Q2xpKGNzdC5FUlJPUl9FWElUKTtcclxuICAgICAgcmV0dXJuIGNiID8gY2IobnVsbCwgZGF0YSkgOiB0aGF0LmV4aXRDbGkoY3N0LlNVQ0NFU1NfRVhJVCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBTcGVjaWFsIGRlbGV0ZSBtZXRob2RcclxuICAgKi9cclxuICBDTEkucHJvdG90eXBlLmRlbGV0ZU1vZHVsZSA9IGZ1bmN0aW9uKG1vZHVsZV9uYW1lLCBjYikge1xyXG4gICAgdmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuICAgIHZhciBmb3VuZF9wcm9jID0gW107XHJcblxyXG4gICAgdGhpcy5DbGllbnQuZ2V0QWxsUHJvY2VzcyhmdW5jdGlvbihlcnIsIHByb2NzKSB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBDb21tb24ucHJpbnRFcnJvcignRXJyb3IgcmV0cmlldmluZyBwcm9jZXNzIGxpc3Q6ICcgKyBlcnIpO1xyXG4gICAgICAgIHJldHVybiBjYihDb21tb24ucmV0RXJyKGVycikpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBwcm9jcy5mb3JFYWNoKGZ1bmN0aW9uKHByb2MpIHtcclxuICAgICAgICBpZiAocHJvYy5wbTJfZW52Lm5hbWUgPT0gbW9kdWxlX25hbWUgJiYgcHJvYy5wbTJfZW52LnBteF9tb2R1bGUpIHtcclxuICAgICAgICAgIGZvdW5kX3Byb2MucHVzaChwcm9jLnBtX2lkKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKGZvdW5kX3Byb2MubGVuZ3RoID09IDApXHJcbiAgICAgICAgcmV0dXJuIGNiKCk7XHJcblxyXG4gICAgICB0aGF0Ll9vcGVyYXRlKCdkZWxldGVQcm9jZXNzSWQnLCBmb3VuZF9wcm9jWzBdLCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICBpZiAoZXJyKSByZXR1cm4gY2IoQ29tbW9uLnJldEVycihlcnIpKTtcclxuICAgICAgICBDb21tb24ucHJpbnRPdXQoJ0luIG1lbW9yeSBwcm9jZXNzIGRlbGV0ZWQnKTtcclxuICAgICAgICByZXR1cm4gY2IoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG59O1xyXG4iXX0=