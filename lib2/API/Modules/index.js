"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = _default;

var _constants = _interopRequireDefault(require("../../../constants"));

var _Common = _interopRequireDefault(require("../../Common"));

var _Modularizer = _interopRequireDefault(require("./Modularizer"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/***************************
 *
 * Module methods
 *
 **************************/
function _default(CLI) {
  /**
   * Install / Update a module
   */
  CLI.prototype.install = function (module_name, opts, cb) {
    var that = this;

    if (typeof opts == 'function') {
      cb = opts;
      opts = {};
    }

    _Modularizer["default"].install(this, module_name, opts, function (err, data) {
      if (err) {
        _Common["default"].printError(_constants["default"].PREFIX_MSG_ERR + (err.message || err));

        return cb ? cb(_Common["default"].retErr(err)) : that.speedList(_constants["default"].ERROR_EXIT);
      }

      return cb ? cb(null, data) : that.speedList(_constants["default"].SUCCESS_EXIT);
    });
  };
  /**
   * Uninstall a module
   */


  CLI.prototype.uninstall = function (module_name, cb) {
    var that = this;

    _Modularizer["default"].uninstall(this, module_name, function (err, data) {
      if (err) return cb ? cb(_Common["default"].retErr(err)) : that.speedList(_constants["default"].ERROR_EXIT);
      return cb ? cb(null, data) : that.speedList(_constants["default"].SUCCESS_EXIT);
    });
  };

  CLI.prototype.launchAll = function (CLI, cb) {
    _Modularizer["default"].launchModules(CLI, cb);
  };

  CLI.prototype["package"] = function (module_path, cb) {
    var _this = this;

    _Modularizer["default"]["package"](this, module_path, function (err, res) {
      if (err) {
        _Common["default"].errMod(err);

        return cb ? cb(err) : _this.exitCli(1);
      }

      _Common["default"].logMod("Module packaged in ".concat(res.path));

      return cb ? cb(err) : _this.exitCli(0);
    });
  };
  /**
   * Publish module on NPM + Git push
   */


  CLI.prototype.publish = function (folder, opts, cb) {
    var that = this;

    _Modularizer["default"].publish(this, folder, opts, function (err, data) {
      if (err) return cb ? cb(_Common["default"].retErr(err)) : that.speedList(_constants["default"].ERROR_EXIT);
      return cb ? cb(null, data) : that.speedList(_constants["default"].SUCCESS_EXIT);
    });
  };
  /**
   * Publish module on NPM + Git push
   */


  CLI.prototype.generateModuleSample = function (app_name, cb) {
    var that = this;

    _Modularizer["default"].generateSample(app_name, function (err, data) {
      if (err) return cb ? cb(_Common["default"].retErr(err)) : that.exitCli(_constants["default"].ERROR_EXIT);
      return cb ? cb(null, data) : that.exitCli(_constants["default"].SUCCESS_EXIT);
    });
  };
  /**
   * Special delete method
   */


  CLI.prototype.deleteModule = function (module_name, cb) {
    var that = this;
    var found_proc = [];
    this.Client.getAllProcess(function (err, procs) {
      if (err) {
        _Common["default"].printError('Error retrieving process list: ' + err);

        return cb(_Common["default"].retErr(err));
      }

      procs.forEach(function (proc) {
        if (proc.pm2_env.name == module_name && proc.pm2_env.pmx_module) {
          found_proc.push(proc.pm_id);
        }
      });
      if (found_proc.length == 0) return cb();

      that._operate('deleteProcessId', found_proc[0], function (err) {
        if (err) return cb(_Common["default"].retErr(err));

        _Common["default"].printOut('In memory process deleted');

        return cb();
      });
    });
  };
}

;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BUEkvTW9kdWxlcy9pbmRleC50cyJdLCJuYW1lcyI6WyJDTEkiLCJwcm90b3R5cGUiLCJpbnN0YWxsIiwibW9kdWxlX25hbWUiLCJvcHRzIiwiY2IiLCJ0aGF0IiwiTW9kdWxhcml6ZXIiLCJlcnIiLCJkYXRhIiwiQ29tbW9uIiwicHJpbnRFcnJvciIsImNzdCIsIlBSRUZJWF9NU0dfRVJSIiwibWVzc2FnZSIsInJldEVyciIsInNwZWVkTGlzdCIsIkVSUk9SX0VYSVQiLCJTVUNDRVNTX0VYSVQiLCJ1bmluc3RhbGwiLCJsYXVuY2hBbGwiLCJsYXVuY2hNb2R1bGVzIiwibW9kdWxlX3BhdGgiLCJyZXMiLCJlcnJNb2QiLCJleGl0Q2xpIiwibG9nTW9kIiwicGF0aCIsInB1Ymxpc2giLCJmb2xkZXIiLCJnZW5lcmF0ZU1vZHVsZVNhbXBsZSIsImFwcF9uYW1lIiwiZ2VuZXJhdGVTYW1wbGUiLCJkZWxldGVNb2R1bGUiLCJmb3VuZF9wcm9jIiwiQ2xpZW50IiwiZ2V0QWxsUHJvY2VzcyIsInByb2NzIiwiZm9yRWFjaCIsInByb2MiLCJwbTJfZW52IiwibmFtZSIsInBteF9tb2R1bGUiLCJwdXNoIiwicG1faWQiLCJsZW5ndGgiLCJfb3BlcmF0ZSIsInByaW50T3V0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBT0E7O0FBQ0E7O0FBSUE7Ozs7QUFYQTs7Ozs7QUFhZSxrQkFBU0EsR0FBVCxFQUFjO0FBQzNCOzs7QUFHQUEsRUFBQUEsR0FBRyxDQUFDQyxTQUFKLENBQWNDLE9BQWQsR0FBd0IsVUFBU0MsV0FBVCxFQUFzQkMsSUFBdEIsRUFBNEJDLEVBQTVCLEVBQWdDO0FBQ3RELFFBQUlDLElBQUksR0FBRyxJQUFYOztBQUVBLFFBQUksT0FBT0YsSUFBUCxJQUFnQixVQUFwQixFQUFnQztBQUM5QkMsTUFBQUEsRUFBRSxHQUFHRCxJQUFMO0FBQ0FBLE1BQUFBLElBQUksR0FBRyxFQUFQO0FBQ0Q7O0FBRURHLDRCQUFZTCxPQUFaLENBQW9C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O0FBQzNCLFlBQUlBLElBQUksQ0FBQ0MsT0FBTCxDQUFhQyxJQUFiLElBQXFCdEMsV0FBckIsSUFBb0NvQyxJQUFJLENBQUNDLE9BQUwsQ0FBYUUsVUFBckQsRUFBaUU7QUFDL0RSLFVBQUFBLFVBQVUsQ0FBQ1MsSUFBWCxDQUFnQkosSUFBSSxDQUFDSyxLQUFyQjtBQUNEO0FBQ0YsT0FKRDtBQU1BLFVBQUlWLFVBQVUsQ0FBQ1csTUFBWCxJQUFxQixDQUF6QixFQUNFLE9BQU94QyxFQUFFLEVBQVQ7O0FBRUZDLE1BQUFBLElBQUksQ0FBQ3dDLFFBQUwsQ0FBYyxpQkFBZCxFQUFpQ1osVUFBVSxDQUFDLENBQUQsQ0FBM0MsRUFBZ0QsVUFBUzFCLEdBQVQsRUFBYztBQUM1RCxZQUFJQSxHQUFKLEVBQVMsT0FBT0gsRUFBRSxDQUFDSyxtQkFBT0ssTUFBUCxDQUFjUCxHQUFkLENBQUQsQ0FBVDs7QUFDVEUsMkJBQU9xQyxRQUFQLENBQWdCLDJCQUFoQjs7QUFDQSxlQUFPMUMsRUFBRSxFQUFUO0FBQ0QsT0FKRDtBQUtELEtBcEJEO0FBcUJELEdBMUJEO0FBMkJEOztBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKlxuICogTW9kdWxlIG1ldGhvZHNcbiAqXG4gKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmltcG9ydCBjc3QgICAgICAgICAgIGZyb20gJy4uLy4uLy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgQ29tbW9uICAgICAgIGZyb20gJy4uLy4uL0NvbW1vbic7XG5pbXBvcnQgY2hhbGsgICAgICAgICBmcm9tICdjaGFsayc7XG5pbXBvcnQgZm9yRWFjaExpbWl0ICBmcm9tICdhc3luYy9mb3JFYWNoTGltaXQnO1xuXG5pbXBvcnQgTW9kdWxhcml6ZXIgZnJvbSAnLi9Nb2R1bGFyaXplcic7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKENMSSkge1xuICAvKipcbiAgICogSW5zdGFsbCAvIFVwZGF0ZSBhIG1vZHVsZVxuICAgKi9cbiAgQ0xJLnByb3RvdHlwZS5pbnN0YWxsID0gZnVuY3Rpb24obW9kdWxlX25hbWUsIG9wdHMsIGNiKSB7XG4gICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgaWYgKHR5cGVvZihvcHRzKSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjYiA9IG9wdHM7XG4gICAgICBvcHRzID0ge307XG4gICAgfVxuXG4gICAgTW9kdWxhcml6ZXIuaW5zdGFsbCh0aGlzLCBtb2R1bGVfbmFtZSwgb3B0cywgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIENvbW1vbi5wcmludEVycm9yKGNzdC5QUkVGSVhfTVNHX0VSUiArIChlcnIubWVzc2FnZSB8fCBlcnIpKTtcbiAgICAgICAgcmV0dXJuIGNiID8gY2IoQ29tbW9uLnJldEVycihlcnIpKSA6IHRoYXQuc3BlZWRMaXN0KGNzdC5FUlJPUl9FWElUKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjYiA/IGNiKG51bGwsIGRhdGEpIDogdGhhdC5zcGVlZExpc3QoY3N0LlNVQ0NFU1NfRVhJVCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFVuaW5zdGFsbCBhIG1vZHVsZVxuICAgKi9cbiAgQ0xJLnByb3RvdHlwZS51bmluc3RhbGwgPSBmdW5jdGlvbihtb2R1bGVfbmFtZSwgY2IpIHtcbiAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICBNb2R1bGFyaXplci51bmluc3RhbGwodGhpcywgbW9kdWxlX25hbWUsIGZ1bmN0aW9uKGVyciwgZGF0YSkge1xuICAgICAgaWYgKGVycilcbiAgICAgICAgcmV0dXJuIGNiID8gY2IoQ29tbW9uLnJldEVycihlcnIpKSA6IHRoYXQuc3BlZWRMaXN0KGNzdC5FUlJPUl9FWElUKTtcbiAgICAgIHJldHVybiBjYiA/IGNiKG51bGwsIGRhdGEpIDogdGhhdC5zcGVlZExpc3QoY3N0LlNVQ0NFU1NfRVhJVCk7XG4gICAgfSk7XG4gIH07XG5cbiAgQ0xJLnByb3RvdHlwZS5sYXVuY2hBbGwgPSBmdW5jdGlvbihDTEksIGNiKSB7XG4gICAgTW9kdWxhcml6ZXIubGF1bmNoTW9kdWxlcyhDTEksIGNiKTtcbiAgfTtcblxuICBDTEkucHJvdG90eXBlLnBhY2thZ2UgPSBmdW5jdGlvbihtb2R1bGVfcGF0aCwgY2IpIHtcbiAgICBNb2R1bGFyaXplci5wYWNrYWdlKHRoaXMsIG1vZHVsZV9wYXRoLCAoZXJyLCByZXMpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgQ29tbW9uLmVyck1vZChlcnIpXG4gICAgICAgIHJldHVybiBjYiA/IGNiKGVycikgOiB0aGlzLmV4aXRDbGkoMSlcbiAgICAgIH1cbiAgICAgIENvbW1vbi5sb2dNb2QoYE1vZHVsZSBwYWNrYWdlZCBpbiAke3Jlcy5wYXRofWApXG4gICAgICByZXR1cm4gY2IgPyBjYihlcnIpIDogdGhpcy5leGl0Q2xpKDApXG4gICAgfSlcbiAgfTtcblxuICAvKipcbiAgICogUHVibGlzaCBtb2R1bGUgb24gTlBNICsgR2l0IHB1c2hcbiAgICovXG4gIENMSS5wcm90b3R5cGUucHVibGlzaCA9IGZ1bmN0aW9uKGZvbGRlciwgb3B0cywgY2IpIHtcbiAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICBNb2R1bGFyaXplci5wdWJsaXNoKHRoaXMsIGZvbGRlciwgb3B0cywgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoZXJyKVxuICAgICAgICByZXR1cm4gY2IgPyBjYihDb21tb24ucmV0RXJyKGVycikpIDogdGhhdC5zcGVlZExpc3QoY3N0LkVSUk9SX0VYSVQpO1xuICAgICAgcmV0dXJuIGNiID8gY2IobnVsbCwgZGF0YSkgOiB0aGF0LnNwZWVkTGlzdChjc3QuU1VDQ0VTU19FWElUKTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogUHVibGlzaCBtb2R1bGUgb24gTlBNICsgR2l0IHB1c2hcbiAgICovXG4gIENMSS5wcm90b3R5cGUuZ2VuZXJhdGVNb2R1bGVTYW1wbGUgPSBmdW5jdGlvbihhcHBfbmFtZSwgY2IpIHtcbiAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICBNb2R1bGFyaXplci5nZW5lcmF0ZVNhbXBsZShhcHBfbmFtZSwgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoZXJyKVxuICAgICAgICByZXR1cm4gY2IgPyBjYihDb21tb24ucmV0RXJyKGVycikpIDogdGhhdC5leGl0Q2xpKGNzdC5FUlJPUl9FWElUKTtcbiAgICAgIHJldHVybiBjYiA/IGNiKG51bGwsIGRhdGEpIDogdGhhdC5leGl0Q2xpKGNzdC5TVUNDRVNTX0VYSVQpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTcGVjaWFsIGRlbGV0ZSBtZXRob2RcbiAgICovXG4gIENMSS5wcm90b3R5cGUuZGVsZXRlTW9kdWxlID0gZnVuY3Rpb24obW9kdWxlX25hbWUsIGNiKSB7XG4gICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgdmFyIGZvdW5kX3Byb2MgPSBbXTtcblxuICAgIHRoaXMuQ2xpZW50LmdldEFsbFByb2Nlc3MoZnVuY3Rpb24oZXJyLCBwcm9jcykge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBDb21tb24ucHJpbnRFcnJvcignRXJyb3IgcmV0cmlldmluZyBwcm9jZXNzIGxpc3Q6ICcgKyBlcnIpO1xuICAgICAgICByZXR1cm4gY2IoQ29tbW9uLnJldEVycihlcnIpKTtcbiAgICAgIH1cblxuICAgICAgcHJvY3MuZm9yRWFjaChmdW5jdGlvbihwcm9jKSB7XG4gICAgICAgIGlmIChwcm9jLnBtMl9lbnYubmFtZSA9PSBtb2R1bGVfbmFtZSAmJiBwcm9jLnBtMl9lbnYucG14X21vZHVsZSkge1xuICAgICAgICAgIGZvdW5kX3Byb2MucHVzaChwcm9jLnBtX2lkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChmb3VuZF9wcm9jLmxlbmd0aCA9PSAwKVxuICAgICAgICByZXR1cm4gY2IoKTtcblxuICAgICAgdGhhdC5fb3BlcmF0ZSgnZGVsZXRlUHJvY2Vzc0lkJywgZm91bmRfcHJvY1swXSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGlmIChlcnIpIHJldHVybiBjYihDb21tb24ucmV0RXJyKGVycikpO1xuICAgICAgICBDb21tb24ucHJpbnRPdXQoJ0luIG1lbW9yeSBwcm9jZXNzIGRlbGV0ZWQnKTtcbiAgICAgICAgcmV0dXJuIGNiKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbn07XG4iXX0=