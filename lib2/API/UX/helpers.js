"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _chalk = _interopRequireDefault(require("chalk"));

var _moment = _interopRequireDefault(require("moment"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

var Helpers = {};
/**
 * Converts Byte to Human readable size
 * @method bytesToSize
 * @param {} bytes
 * @param {} precision
 * @return
 */

Helpers.bytesToSize = function (bytes, precision) {
  var kilobyte = 1024;
  var megabyte = kilobyte * 1024;
  var gigabyte = megabyte * 1024;
  var terabyte = gigabyte * 1024;

  if (bytes >= 0 && bytes < kilobyte) {
    return bytes + 'b ';
  } else if (bytes >= kilobyte && bytes < megabyte) {
    return (bytes / kilobyte).toFixed(precision) + 'kb ';
  } else if (bytes >= megabyte && bytes < gigabyte) {
    return (bytes / megabyte).toFixed(precision) + 'mb ';
  } else if (bytes >= gigabyte && bytes < terabyte) {
    return (bytes / gigabyte).toFixed(precision) + 'gb ';
  } else if (bytes >= terabyte) {
    return (bytes / terabyte).toFixed(precision) + 'tb ';
  } else {
    return bytes + 'b ';
  }
};
/**
 * Color Process state
 * @method colorStatus
 * @param {} status
 * @return
 */


Helpers.colorStatus = function (status) {
  switch (status) {
    case 'online':
      return _chalk["default"].green.bold('online');
      break;

    case 'running':
      return _chalk["default"].green.bold('online');
      break;

    case 'restarting':
      return _chalk["default"].yellow.bold('restart');
      break;

    case 'created':
      return _chalk["default"].yellow.bold('created');
      break;

    case 'launching':
      return _chalk["default"].blue.bold('launching');
      break;

    default:
      return _chalk["default"].red.bold(status);
  }
};
/**
 * Safe Push
 */


Helpers.safe_push = function () {
  var argv = arguments;
  var table = argv[0];

  for (var i = 1; i < argv.length; ++i) {
    var elem = argv[i];

    if (elem[Object.keys(elem)[0]] === undefined || elem[Object.keys(elem)[0]] === null) {
      elem[Object.keys(elem)[0]] = 'N/A';
    } else if (Array.isArray(elem[Object.keys(elem)[0]])) {
      elem[Object.keys(elem)[0]].forEach(function (curr, j) {
        if (curr === undefined || curr === null) elem[Object.keys(elem)[0]][j] = 'N/A';
      });
    }

    table.push(elem);
  }
};
/**
 * Description
 * @method timeSince
 * @param {} date
 * @return BinaryExpression
 */


Helpers.timeSince = function (date) {
  // TODO: please check this
  var seconds = Math.floor((0, _moment["default"])().subtract(date, "days").unix() / 1000);
  var interval = Math.floor(seconds / 31536000);

  if (interval > 1) {
    return interval + 'Y';
  }

  interval = Math.floor(seconds / 2592000);

  if (interval > 1) {
    return interval + 'M';
  }

  interval = Math.floor(seconds / 86400);

  if (interval > 1) {
    return interval + 'D';
  }

  interval = Math.floor(seconds / 3600);

  if (interval > 1) {
    return interval + 'h';
  }

  interval = Math.floor(seconds / 60);

  if (interval > 1) {
    return interval + 'm';
  }

  return Math.floor(seconds) + 's';
};
/**
 * Colorize Metrics
 *
 * @param {Number} value current value
 * @param {Number} warn value threshold
 * @param {Number} alert value threshold
 * @param {String} prefix value prefix
 * @return {String} value
 */


Helpers.colorizedMetric = function (value, warn, alert, prefix) {
  var inverted = false;
  if (alert < warn) inverted = true;
  if (!prefix) prefix = '';
  if (isNaN(value) === true) return 'N/A';
  if (value == 0) return 0 + prefix;

  if (inverted == true) {
    if (value > warn) return _chalk["default"].green(value + prefix);
    if (value <= warn && value >= alert) return _chalk["default"].bold.yellow(value + prefix);
    return _chalk["default"].bold.red(value + prefix);
  }

  if (value < warn) return _chalk["default"].green(value + prefix);
  if (value >= warn && value <= alert) return _chalk["default"].bold.yellow(value + prefix);
  return _chalk["default"].bold.red(value + prefix);
};
/**
 * Get nested property
 *
 * @param {String} propertyName
 * @param {Object} obj
 * @returns {String} property value
 */


Helpers.getNestedProperty = function (propertyName, obj) {
  var parts = propertyName.split('.'),
      length = parts.length,
      property = obj || {};

  for (var i = 0; i < length; i++) {
    property = property[parts[i]];
  }

  return property;
};

Helpers.openEditor = function (file, opts, cb) {
  var spawn = require('child_process').spawn;

  if (typeof opts === 'function') {
    cb = opts;
    opts = {};
  }

  if (!opts) opts = {};
  var ed = /^win/.test(process.platform) ? 'notepad' : 'vim';
  var editor = opts.editor || process.env.VISUAL || process.env.EDITOR || ed;
  var args = editor.split(/\s+/);
  var bin = args.shift();
  var ps = spawn(bin, args.concat([file]), {
    stdio: 'inherit'
  });
  ps.on('exit', function (code, sig) {
    if (typeof cb === 'function') cb(code, sig);
  });
};

Helpers.dispKeys = function (kv, target_module) {
  Object.keys(kv).forEach(function (key) {
    if (target_module != null && target_module != key) return false;

    if (_typeof(kv[key]) == 'object') {
      var obj = {};
      console.log(_chalk["default"].bold('Module: ') + _chalk["default"].bold.blue(key));
      Object.keys(kv[key]).forEach(function (sub_key) {
        console.log("$ pm2 set ".concat(key, ":").concat(sub_key, " ").concat(kv[key][sub_key]));
      });
    }
  });
};

var _default = Helpers;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BUEkvVVgvaGVscGVycy50cyJdLCJuYW1lcyI6WyJIZWxwZXJzIiwiYnl0ZXNUb1NpemUiLCJieXRlcyIsInByZWNpc2lvbiIsImtpbG9ieXRlIiwibWVnYWJ5dGUiLCJnaWdhYnl0ZSIsInRlcmFieXRlIiwidG9GaXhlZCIsImNvbG9yU3RhdHVzIiwic3RhdHVzIiwiY2hhbGsiLCJncmVlbiIsImJvbGQiLCJ5ZWxsb3ciLCJibHVlIiwicmVkIiwic2FmZV9wdXNoIiwiYXJndiIsImFyZ3VtZW50cyIsInRhYmxlIiwiaSIsImxlbmd0aCIsImVsZW0iLCJPYmplY3QiLCJrZXlzIiwidW5kZWZpbmVkIiwiQXJyYXkiLCJpc0FycmF5IiwiZm9yRWFjaCIsImN1cnIiLCJqIiwicHVzaCIsInRpbWVTaW5jZSIsImRhdGUiLCJzZWNvbmRzIiwiTWF0aCIsImZsb29yIiwic3VidHJhY3QiLCJ1bml4IiwiaW50ZXJ2YWwiLCJjb2xvcml6ZWRNZXRyaWMiLCJ2YWx1ZSIsIndhcm4iLCJhbGVydCIsInByZWZpeCIsImludmVydGVkIiwiaXNOYU4iLCJnZXROZXN0ZWRQcm9wZXJ0eSIsInByb3BlcnR5TmFtZSIsIm9iaiIsInBhcnRzIiwic3BsaXQiLCJwcm9wZXJ0eSIsIm9wZW5FZGl0b3IiLCJmaWxlIiwib3B0cyIsImNiIiwic3Bhd24iLCJyZXF1aXJlIiwiZWQiLCJ0ZXN0IiwicHJvY2VzcyIsInBsYXRmb3JtIiwiZWRpdG9yIiwiZW52IiwiVklTVUFMIiwiRURJVE9SIiwiYXJncyIsImJpbiIsInNoaWZ0IiwicHMiLCJjb25jYXQiLCJzdGRpbyIsIm9uIiwiY29kZSIsInNpZyIsImRpc3BLZXlzIiwia3YiLCJ0YXJnZXRfbW9kdWxlIiwia2V5IiwiY29uc29sZSIsImxvZyIsInN1Yl9rZXkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7Ozs7O0FBQ0EsSUFBTUEsT0FBWSxHQUFHLEVBQXJCO0FBRUE7Ozs7Ozs7O0FBT0FBLE9B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QUFSLEdBQW1CLFVBQVNDLEVBQVQsRUFBYUMsYUFBYixFQUE0QjtBQUM3Q3ZELEVBQUFBLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZcUQsRUFBWixFQUFnQmpELE9BQWhCLENBQXdCLFVBQVNtRCxHQUFULEVBQWM7QUFFcEMsUUFBSUQsYUFBYSxJQUFJLElBQWpCLElBQXlCQSxhQUFhLElBQUlDLEdBQTlDLEVBQ0UsT0FBTyxLQUFQOztBQUVGLFFBQUksUUFBT0YsRUFBRSxDQUFDRSxHQUFELENBQVQsS0FBbUIsUUFBdkIsRUFBaUM7QUFDL0IsVUFBSTlCLEdBQUcsR0FBRyxFQUFWO0FBRUErQixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWXZFLGtCQUFNRSxJQUFOLENBQVcsVUFBWCxJQUF5QkYsa0JBQU1FLElBQU4sQ0FBV0UsSUFBWCxDQUFnQmlFLEdBQWhCLENBQXJDO0FBQ0F4RCxNQUFBQSxNQUFNLENBQUNDLElBQVAsQ0FBWXFELEVBQUUsQ0FBQ0UsR0FBRCxDQUFkLEVBQXFCbkQsT0FBckIsQ0FBNkIsVUFBU3NELE9BQVQsRUFBa0I7QUFDN0NGLFFBQUFBLE9BQU8sQ0FBQ0MsR0FBUixxQkFBeUJGLEdBQXpCLGNBQWdDRyxPQUFoQyxjQUEyQ0wsRUFBRSxDQUFDRSxHQUFELENBQUYsQ0FBUUcsT0FBUixDQUEzQztBQUNELE9BRkQ7QUFHRDtBQUNGLEdBYkQ7QUFjRCxDQWZEOztlQWlCZW5GLE8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuY29uc3QgSGVscGVyczogYW55ID0ge31cblxuLyoqXG4gKiBDb252ZXJ0cyBCeXRlIHRvIEh1bWFuIHJlYWRhYmxlIHNpemVcbiAqIEBtZXRob2QgYnl0ZXNUb1NpemVcbiAqIEBwYXJhbSB7fSBieXRlc1xuICogQHBhcmFtIHt9IHByZWNpc2lvblxuICogQHJldHVyblxuICovXG5IZWxwZXJzLmJ5dGVzVG9TaXplID0gZnVuY3Rpb24oYnl0ZXMsIHByZWNpc2lvbikge1xuICB2YXIga2lsb2J5dGUgPSAxMDI0XG4gIHZhciBtZWdhYnl0ZSA9IGtpbG9ieXRlICogMTAyNFxuICB2YXIgZ2lnYWJ5dGUgPSBtZWdhYnl0ZSAqIDEwMjRcbiAgdmFyIHRlcmFieXRlID0gZ2lnYWJ5dGUgKiAxMDI0XG5cbiAgaWYgKChieXRlcyA+PSAwKSAmJiAoYnl0ZXMgPCBraWxvYnl0ZSkpIHtcbiAgICByZXR1cm4gYnl0ZXMgKyAnYiAnXG4gIH0gZWxzZSBpZiAoKGJ5dGVzID49IGtpbG9ieXRlKSAmJiAoYnl0ZXMgPCBtZWdhYnl0ZSkpIHtcbiAgICByZXR1cm4gKGJ5dGVzIC8ga2lsb2J5dGUpLnRvRml4ZWQocHJlY2lzaW9uKSArICdrYiAnXG4gIH0gZWxzZSBpZiAoKGJ5dGVzID49IG1lZ2FieXRlKSAmJiAoYnl0ZXMgPCBnaWdhYnl0ZSkpIHtcbiAgICByZXR1cm4gKGJ5dGVzIC8gbWVnYWJ5dGUpLnRvRml4ZWQocHJlY2lzaW9uKSArICdtYiAnXG4gIH0gZWxzZSBpZiAoKGJ5dGVzID49IGdpZ2FieXRlKSAmJiAoYnl0ZXMgPCB0ZXJhYnl0ZSkpIHtcbiAgICByZXR1cm4gKGJ5dGVzIC8gZ2lnYWJ5dGUpLnRvRml4ZWQocHJlY2lzaW9uKSArICdnYiAnXG4gIH0gZWxzZSBpZiAoYnl0ZXMgPj0gdGVyYWJ5dGUpIHtcbiAgICByZXR1cm4gKGJ5dGVzIC8gdGVyYWJ5dGUpLnRvRml4ZWQocHJlY2lzaW9uKSArICd0YiAnXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGJ5dGVzICsgJ2IgJ1xuICB9XG59XG5cblxuLyoqXG4gKiBDb2xvciBQcm9jZXNzIHN0YXRlXG4gKiBAbWV0aG9kIGNvbG9yU3RhdHVzXG4gKiBAcGFyYW0ge30gc3RhdHVzXG4gKiBAcmV0dXJuXG4gKi9cbkhlbHBlcnMuY29sb3JTdGF0dXMgPSBmdW5jdGlvbihzdGF0dXMpIHtcbiAgc3dpdGNoIChzdGF0dXMpIHtcblxuICBjYXNlICdvbmxpbmUnOlxuICAgIHJldHVybiBjaGFsay5ncmVlbi5ib2xkKCdvbmxpbmUnKVxuICAgIGJyZWFrXG4gIGNhc2UgJ3J1bm5pbmcnOlxuICAgIHJldHVybiBjaGFsay5ncmVlbi5ib2xkKCdvbmxpbmUnKVxuICAgIGJyZWFrXG4gIGNhc2UgJ3Jlc3RhcnRpbmcnOlxuICAgIHJldHVybiBjaGFsay55ZWxsb3cuYm9sZCgncmVzdGFydCcpXG4gICAgYnJlYWtcbiAgY2FzZSAnY3JlYXRlZCc6XG4gICAgcmV0dXJuIGNoYWxrLnllbGxvdy5ib2xkKCdjcmVhdGVkJylcbiAgICBicmVha1xuICBjYXNlICdsYXVuY2hpbmcnOlxuICAgIHJldHVybiBjaGFsay5ibHVlLmJvbGQoJ2xhdW5jaGluZycpXG4gICAgYnJlYWtcbiAgZGVmYXVsdDpcbiAgICByZXR1cm4gY2hhbGsucmVkLmJvbGQoc3RhdHVzKVxuICB9XG59XG5cbi8qKlxuICogU2FmZSBQdXNoXG4gKi9cbkhlbHBlcnMuc2FmZV9wdXNoID0gZnVuY3Rpb24oKSB7XG4gIHZhciBhcmd2ID0gYXJndW1lbnRzXG4gIHZhciB0YWJsZSA9IGFyZ3ZbMF1cblxuICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3YubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgZWxlbSA9IGFyZ3ZbaV1cbiAgICBpZiAoZWxlbVtPYmplY3Qua2V5cyhlbGVtKVswXV0gPT09IHVuZGVmaW5lZFxuICAgICAgICB8fCBlbGVtW09iamVjdC5rZXlzKGVsZW0pWzBdXSA9PT0gbnVsbCkge1xuICAgICAgZWxlbVtPYmplY3Qua2V5cyhlbGVtKVswXV0gPSAnTi9BJ1xuICAgIH1cbiAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KGVsZW1bT2JqZWN0LmtleXMoZWxlbSlbMF1dKSkge1xuICAgICAgZWxlbVtPYmplY3Qua2V5cyhlbGVtKVswXV0uZm9yRWFjaChmdW5jdGlvbihjdXJyLCBqKSB7XG4gICAgICAgIGlmIChjdXJyID09PSB1bmRlZmluZWQgfHwgY3VyciA9PT0gbnVsbClcbiAgICAgICAgICBlbGVtW09iamVjdC5rZXlzKGVsZW0pWzBdXVtqXSA9ICdOL0EnXG4gICAgICB9KVxuICAgIH1cbiAgICB0YWJsZS5wdXNoKGVsZW0pXG4gIH1cbn1cblxuLyoqXG4gKiBEZXNjcmlwdGlvblxuICogQG1ldGhvZCB0aW1lU2luY2VcbiAqIEBwYXJhbSB7fSBkYXRlXG4gKiBAcmV0dXJuIEJpbmFyeUV4cHJlc3Npb25cbiAqL1xuSGVscGVycy50aW1lU2luY2UgPSBmdW5jdGlvbihkYXRlKSB7XG4gIC8vIFRPRE86IHBsZWFzZSBjaGVjayB0aGlzXG4gIHZhciBzZWNvbmRzID0gTWF0aC5mbG9vcihtb21lbnQoKS5zdWJ0cmFjdChkYXRlLCBcImRheXNcIikudW5peCgpIC8gMTAwMClcblxuICB2YXIgaW50ZXJ2YWwgPSBNYXRoLmZsb29yKHNlY29uZHMgLyAzMTUzNjAwMClcblxuICBpZiAoaW50ZXJ2YWwgPiAxKSB7XG4gICAgcmV0dXJuIGludGVydmFsICsgJ1knXG4gIH1cbiAgaW50ZXJ2YWwgPSBNYXRoLmZsb29yKHNlY29uZHMgLyAyNTkyMDAwKVxuICBpZiAoaW50ZXJ2YWwgPiAxKSB7XG4gICAgcmV0dXJuIGludGVydmFsICsgJ00nXG4gIH1cbiAgaW50ZXJ2YWwgPSBNYXRoLmZsb29yKHNlY29uZHMgLyA4NjQwMClcbiAgaWYgKGludGVydmFsID4gMSkge1xuICAgIHJldHVybiBpbnRlcnZhbCArICdEJ1xuICB9XG4gIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMClcbiAgaWYgKGludGVydmFsID4gMSkge1xuICAgIHJldHVybiBpbnRlcnZhbCArICdoJ1xuICB9XG4gIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApXG4gIGlmIChpbnRlcnZhbCA+IDEpIHtcbiAgICByZXR1cm4gaW50ZXJ2YWwgKyAnbSdcbiAgfVxuICByZXR1cm4gTWF0aC5mbG9vcihzZWNvbmRzKSArICdzJ1xufVxuXG4vKipcbiAqIENvbG9yaXplIE1ldHJpY3NcbiAqXG4gKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgY3VycmVudCB2YWx1ZVxuICogQHBhcmFtIHtOdW1iZXJ9IHdhcm4gdmFsdWUgdGhyZXNob2xkXG4gKiBAcGFyYW0ge051bWJlcn0gYWxlcnQgdmFsdWUgdGhyZXNob2xkXG4gKiBAcGFyYW0ge1N0cmluZ30gcHJlZml4IHZhbHVlIHByZWZpeFxuICogQHJldHVybiB7U3RyaW5nfSB2YWx1ZVxuICovXG5IZWxwZXJzLmNvbG9yaXplZE1ldHJpYyA9IGZ1bmN0aW9uKHZhbHVlLCB3YXJuLCBhbGVydCwgcHJlZml4KSB7XG4gIHZhciBpbnZlcnRlZCA9IGZhbHNlXG4gIGlmIChhbGVydCA8IHdhcm4pXG4gICAgaW52ZXJ0ZWQgPSB0cnVlXG5cbiAgaWYgKCFwcmVmaXgpIHByZWZpeCA9ICcnXG4gIGlmIChpc05hTih2YWx1ZSkgPT09IHRydWUpXG4gICAgcmV0dXJuICdOL0EnXG4gIGlmICh2YWx1ZSA9PSAwKVxuICAgIHJldHVybiAwICsgcHJlZml4XG4gIGlmIChpbnZlcnRlZCA9PSB0cnVlKSB7XG4gICAgaWYgKHZhbHVlID4gd2FybilcbiAgICAgIHJldHVybiBjaGFsay5ncmVlbih2YWx1ZSArIHByZWZpeClcbiAgICBpZiAodmFsdWUgPD0gd2FybiAmJiB2YWx1ZSA+PSBhbGVydClcbiAgICAgIHJldHVybiBjaGFsay5ib2xkLnllbGxvdyh2YWx1ZSArIHByZWZpeClcbiAgICByZXR1cm4gY2hhbGsuYm9sZC5yZWQodmFsdWUgKyBwcmVmaXgpXG4gIH1cbiAgaWYgKHZhbHVlIDwgd2FybilcbiAgICByZXR1cm4gY2hhbGsuZ3JlZW4odmFsdWUgKyBwcmVmaXgpXG4gIGlmICh2YWx1ZSA+PSB3YXJuICYmIHZhbHVlIDw9IGFsZXJ0KVxuICAgIHJldHVybiBjaGFsay5ib2xkLnllbGxvdyh2YWx1ZSArIHByZWZpeClcbiAgcmV0dXJuIGNoYWxrLmJvbGQucmVkKHZhbHVlICsgcHJlZml4KVxufVxuXG4vKipcbiAqIEdldCBuZXN0ZWQgcHJvcGVydHlcbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHlOYW1lXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqXG4gKiBAcmV0dXJucyB7U3RyaW5nfSBwcm9wZXJ0eSB2YWx1ZVxuICovXG5IZWxwZXJzLmdldE5lc3RlZFByb3BlcnR5ID0gZnVuY3Rpb24ocHJvcGVydHlOYW1lLCBvYmopIHtcbiAgdmFyIHBhcnRzID0gcHJvcGVydHlOYW1lLnNwbGl0KCcuJyksXG4gICAgICBsZW5ndGggPSBwYXJ0cy5sZW5ndGgsXG4gICAgICBwcm9wZXJ0eSA9IG9iaiB8fCB7fVxuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKysgKSB7XG4gICAgcHJvcGVydHkgPSBwcm9wZXJ0eVtwYXJ0c1tpXV1cbiAgfVxuXG4gIHJldHVybiBwcm9wZXJ0eVxufVxuXG5IZWxwZXJzLm9wZW5FZGl0b3IgPSBmdW5jdGlvbiAoZmlsZSwgb3B0cywgY2IpIHtcbiAgdmFyIHNwYXduID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpLnNwYXduXG5cbiAgaWYgKHR5cGVvZiBvcHRzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY2IgPSBvcHRzXG4gICAgb3B0cyA9IHt9XG4gIH1cblxuICBpZiAoIW9wdHMpIG9wdHMgPSB7fVxuXG4gIHZhciBlZCA9IC9ed2luLy50ZXN0KHByb2Nlc3MucGxhdGZvcm0pID8gJ25vdGVwYWQnIDogJ3ZpbSdcbiAgdmFyIGVkaXRvciA9IG9wdHMuZWRpdG9yIHx8IHByb2Nlc3MuZW52LlZJU1VBTCB8fCBwcm9jZXNzLmVudi5FRElUT1IgfHwgZWRcbiAgdmFyIGFyZ3MgPSBlZGl0b3Iuc3BsaXQoL1xccysvKVxuICB2YXIgYmluID0gYXJncy5zaGlmdCgpXG5cbiAgdmFyIHBzID0gc3Bhd24oYmluLCBhcmdzLmNvbmNhdChbIGZpbGUgXSksIHsgc3RkaW86ICdpbmhlcml0JyB9KVxuXG4gIHBzLm9uKCdleGl0JywgZnVuY3Rpb24gKGNvZGUsIHNpZykge1xuICAgIGlmICh0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIGNiKGNvZGUsIHNpZylcbiAgfSlcbn1cblxuXG5IZWxwZXJzLmRpc3BLZXlzID0gZnVuY3Rpb24oa3YsIHRhcmdldF9tb2R1bGUpIHtcbiAgT2JqZWN0LmtleXMoa3YpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG5cbiAgICBpZiAodGFyZ2V0X21vZHVsZSAhPSBudWxsICYmIHRhcmdldF9tb2R1bGUgIT0ga2V5KVxuICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICBpZiAodHlwZW9mKGt2W2tleV0pID09ICdvYmplY3QnKSB7XG4gICAgICB2YXIgb2JqID0ge31cblxuICAgICAgY29uc29sZS5sb2coY2hhbGsuYm9sZCgnTW9kdWxlOiAnKSArIGNoYWxrLmJvbGQuYmx1ZShrZXkpKVxuICAgICAgT2JqZWN0LmtleXMoa3Zba2V5XSkuZm9yRWFjaChmdW5jdGlvbihzdWJfa2V5KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAkIHBtMiBzZXQgJHtrZXl9OiR7c3ViX2tleX0gJHtrdltrZXldW3N1Yl9rZXldfWApXG4gICAgICB9KVxuICAgIH1cbiAgfSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgSGVscGVyc1xuIl19