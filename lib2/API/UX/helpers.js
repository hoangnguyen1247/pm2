"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _chalk = _interopRequireDefault(require("chalk"));

var _moment = _interopRequireDefault(require("moment"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

var Helpers = {};
/**
 * Converts Byte to Human readable size
 * @method bytesToSize
 * @param {} bytes
 * @param {} precision
 * @return
 */

Helpers.bytesToSize = function (bytes, precision) {
  var kilobyte = 1024;
  var megabyte = kilobyte * 1024;
  var gigabyte = megabyte * 1024;
  var terabyte = gigabyte * 1024;

  if (bytes >= 0 && bytes < kilobyte) {
    return bytes + 'b ';
  } else if (bytes >= kilobyte && bytes < megabyte) {
    return (bytes / kilobyte).toFixed(precision) + 'kb ';
  } else if (bytes >= megabyte && bytes < gigabyte) {
    return (bytes / megabyte).toFixed(precision) + 'mb ';
  } else if (bytes >= gigabyte && bytes < terabyte) {
    return (bytes / gigabyte).toFixed(precision) + 'gb ';
  } else if (bytes >= terabyte) {
    return (bytes / terabyte).toFixed(precision) + 'tb ';
  } else {
    return bytes + 'b ';
  }
};
/**
 * Color Process state
 * @method colorStatus
 * @param {} status
 * @return
 */


Helpers.colorStatus = function (status) {
  switch (status) {
    case 'online':
      return _chalk["default"].green.bold('online');
      break;

    case 'running':
      return _chalk["default"].green.bold('online');
      break;

    case 'restarting':
      return _chalk["default"].yellow.bold('restart');
      break;

    case 'created':
      return _chalk["default"].yellow.bold('created');
      break;

    case 'launching':
      return _chalk["default"].blue.bold('launching');
      break;

    default:
      return _chalk["default"].red.bold(status);
  }
};
/**
 * Safe Push
 */


Helpers.safe_push = function () {
  var argv = arguments;
  var table = argv[0];

  for (var i = 1; i < argv.length; ++i) {
    var elem = argv[i];

    if (elem[Object.keys(elem)[0]] === undefined || elem[Object.keys(elem)[0]] === null) {
      elem[Object.keys(elem)[0]] = 'N/A';
    } else if (Array.isArray(elem[Object.keys(elem)[0]])) {
      elem[Object.keys(elem)[0]].forEach(function (curr, j) {
        if (curr === undefined || curr === null) elem[Object.keys(elem)[0]][j] = 'N/A';
      });
    }

    table.push(elem);
  }
};
/**
 * Description
 * @method timeSince
 * @param {} date
 * @return BinaryExpression
 */


Helpers.timeSince = function (date) {
  // TODO: please check this
  var seconds = Math.floor((0, _moment["default"])().subtract(date, "days").unix() / 1000);
  var interval = Math.floor(seconds / 31536000);

  if (interval > 1) {
    return interval + 'Y';
  }

  interval = Math.floor(seconds / 2592000);

  if (interval > 1) {
    return interval + 'M';
  }

  interval = Math.floor(seconds / 86400);

  if (interval > 1) {
    return interval + 'D';
  }

  interval = Math.floor(seconds / 3600);

  if (interval > 1) {
    return interval + 'h';
  }

  interval = Math.floor(seconds / 60);

  if (interval > 1) {
    return interval + 'm';
  }

  return Math.floor(seconds) + 's';
};
/**
 * Colorize Metrics
 *
 * @param {Number} value current value
 * @param {Number} warn value threshold
 * @param {Number} alert value threshold
 * @param {String} prefix value prefix
 * @return {String} value
 */


Helpers.colorizedMetric = function (value, warn, alert, prefix) {
  var inverted = false;
  if (alert < warn) inverted = true;
  if (!prefix) prefix = '';
  if (isNaN(value) === true) return 'N/A';
  if (value == 0) return 0 + prefix;

  if (inverted == true) {
    if (value > warn) return _chalk["default"].green(value + prefix);
    if (value <= warn && value >= alert) return _chalk["default"].bold.yellow(value + prefix);
    return _chalk["default"].bold.red(value + prefix);
  }

  if (value < warn) return _chalk["default"].green(value + prefix);
  if (value >= warn && value <= alert) return _chalk["default"].bold.yellow(value + prefix);
  return _chalk["default"].bold.red(value + prefix);
};
/**
 * Get nested property
 *
 * @param {String} propertyName
 * @param {Object} obj
 * @returns {String} property value
 */


Helpers.getNestedProperty = function (propertyName, obj) {
  var parts = propertyName.split('.'),
      length = parts.length,
      property = obj || {};

  for (var i = 0; i < length; i++) {
    property = property[parts[i]];
  }

  return property;
};

Helpers.openEditor = function (file, opts, cb) {
  var spawn = require('child_process').spawn;

  if (typeof opts === 'function') {
    cb = opts;
    opts = {};
  }

  if (!opts) opts = {};
  var ed = /^win/.test(process.platform) ? 'notepad' : 'vim';
  var editor = opts.editor || process.env.VISUAL || process.env.EDITOR || ed;
  var args = editor.split(/\s+/);
  var bin = args.shift();
  var ps = spawn(bin, args.concat([file]), {
    stdio: 'inherit'
  });
  ps.on('exit', function (code, sig) {
    if (typeof cb === 'function') cb(code, sig);
  });
};

Helpers.dispKeys = function (kv, target_module) {
  Object.keys(kv).forEach(function (key) {
    if (target_module != null && target_module != key) return false;

    if (_typeof(kv[key]) == 'object') {
      var obj = {};
      console.log(_chalk["default"].bold('Module: ') + _chalk["default"].bold.blue(key));
      Object.keys(kv[key]).forEach(function (sub_key) {
        console.log("$ pm2 set ".concat(key, ":").concat(sub_key, " ").concat(kv[key][sub_key]));
      });
    }
  });
};

var _default = Helpers;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BUEkvVVgvaGVscGVycy50cyJdLCJuYW1lcyI6WyJIZWxwZXJzIiwiYnl0ZXNUb1NpemUiLCJieXRlcyIsInByZWNpc2lvbiIsImtpbG9ieXRlIiwibWVnYWJ5dGUiLCJnaWdhYnl0ZSIsInRlcmFieXRlIiwidG9GaXhlZCIsImNvbG9yU3RhdHVzIiwic3RhdHVzIiwiY2hhbGsiLCJncmVlbiIsImJvbGQiLCJ5ZWxsb3ciLCJibHVlIiwicmVkIiwic2FmZV9wdXNoIiwiYXJndiIsImFyZ3VtZW50cyIsInRhYmxlIiwiaSIsImxlbmd0aCIsImVsZW0iLCJPYmplY3QiLCJrZXlzIiwidW5kZWZpbmVkIiwiQXJyYXkiLCJpc0FycmF5IiwiZm9yRWFjaCIsImN1cnIiLCJqIiwicHVzaCIsInRpbWVTaW5jZSIsImRhdGUiLCJzZWNvbmRzIiwiTWF0aCIsImZsb29yIiwic3VidHJhY3QiLCJ1bml4IiwiaW50ZXJ2YWwiLCJjb2xvcml6ZWRNZXRyaWMiLCJ2YWx1ZSIsIndhcm4iLCJhbGVydCIsInByZWZpeCIsImludmVydGVkIiwiaXNOYU4iLCJnZXROZXN0ZWRQcm9wZXJ0eSIsInByb3BlcnR5TmFtZSIsIm9iaiIsInBhcnRzIiwic3BsaXQiLCJwcm9wZXJ0eSIsIm9wZW5FZGl0b3IiLCJmaWxlIiwib3B0cyIsImNiIiwic3Bhd24iLCJyZXF1aXJlIiwiZWQiLCJ0ZXN0IiwicHJvY2VzcyIsInBsYXRmb3JtIiwiZWRpdG9yIiwiZW52IiwiVklTVUFMIiwiRURJVE9SIiwiYXJncyIsImJpbiIsInNoaWZ0IiwicHMiLCJjb25jYXQiLCJzdGRpbyIsIm9uIiwiY29kZSIsInNpZyIsImRpc3BLZXlzIiwia3YiLCJ0YXJnZXRfbW9kdWxlIiwia2V5IiwiY29uc29sZSIsImxvZyIsInN1Yl9rZXkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7Ozs7O0FBQ0EsSUFBTUEsT0FBWSxHQUFHLEVBQXJCO0FBRUE7Ozs7Ozs7O0FBT0FBLE9B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QUFSLEdBQW1CLFVBQVNDLEVBQVQsRUFBYUMsYUFBYixFQUE0QjtBQUM3Q3ZELEVBQUFBLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZcUQsRUFBWixFQUFnQmpELE9BQWhCLENBQXdCLFVBQVNtRCxHQUFULEVBQWM7QUFFcEMsUUFBSUQsYUFBYSxJQUFJLElBQWpCLElBQXlCQSxhQUFhLElBQUlDLEdBQTlDLEVBQ0UsT0FBTyxLQUFQOztBQUVGLFFBQUksUUFBT0YsRUFBRSxDQUFDRSxHQUFELENBQVQsS0FBbUIsUUFBdkIsRUFBaUM7QUFDL0IsVUFBSTlCLEdBQUcsR0FBRyxFQUFWO0FBRUErQixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWXZFLGtCQUFNRSxJQUFOLENBQVcsVUFBWCxJQUF5QkYsa0JBQU1FLElBQU4sQ0FBV0UsSUFBWCxDQUFnQmlFLEdBQWhCLENBQXJDO0FBQ0F4RCxNQUFBQSxNQUFNLENBQUNDLElBQVAsQ0FBWXFELEVBQUUsQ0FBQ0UsR0FBRCxDQUFkLEVBQXFCbkQsT0FBckIsQ0FBNkIsVUFBU3NELE9BQVQsRUFBa0I7QUFDN0NGLFFBQUFBLE9BQU8sQ0FBQ0MsR0FBUixxQkFBeUJGLEdBQXpCLGNBQWdDRyxPQUFoQyxjQUEyQ0wsRUFBRSxDQUFDRSxHQUFELENBQUYsQ0FBUUcsT0FBUixDQUEzQztBQUNELE9BRkQ7QUFHRDtBQUNGLEdBYkQ7QUFjRCxDQWZEOztlQWlCZW5GLE8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnO1xyXG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XHJcbmNvbnN0IEhlbHBlcnM6IGFueSA9IHt9XHJcblxyXG4vKipcclxuICogQ29udmVydHMgQnl0ZSB0byBIdW1hbiByZWFkYWJsZSBzaXplXHJcbiAqIEBtZXRob2QgYnl0ZXNUb1NpemVcclxuICogQHBhcmFtIHt9IGJ5dGVzXHJcbiAqIEBwYXJhbSB7fSBwcmVjaXNpb25cclxuICogQHJldHVyblxyXG4gKi9cclxuSGVscGVycy5ieXRlc1RvU2l6ZSA9IGZ1bmN0aW9uKGJ5dGVzLCBwcmVjaXNpb24pIHtcclxuICB2YXIga2lsb2J5dGUgPSAxMDI0XHJcbiAgdmFyIG1lZ2FieXRlID0ga2lsb2J5dGUgKiAxMDI0XHJcbiAgdmFyIGdpZ2FieXRlID0gbWVnYWJ5dGUgKiAxMDI0XHJcbiAgdmFyIHRlcmFieXRlID0gZ2lnYWJ5dGUgKiAxMDI0XHJcblxyXG4gIGlmICgoYnl0ZXMgPj0gMCkgJiYgKGJ5dGVzIDwga2lsb2J5dGUpKSB7XHJcbiAgICByZXR1cm4gYnl0ZXMgKyAnYiAnXHJcbiAgfSBlbHNlIGlmICgoYnl0ZXMgPj0ga2lsb2J5dGUpICYmIChieXRlcyA8IG1lZ2FieXRlKSkge1xyXG4gICAgcmV0dXJuIChieXRlcyAvIGtpbG9ieXRlKS50b0ZpeGVkKHByZWNpc2lvbikgKyAna2IgJ1xyXG4gIH0gZWxzZSBpZiAoKGJ5dGVzID49IG1lZ2FieXRlKSAmJiAoYnl0ZXMgPCBnaWdhYnl0ZSkpIHtcclxuICAgIHJldHVybiAoYnl0ZXMgLyBtZWdhYnl0ZSkudG9GaXhlZChwcmVjaXNpb24pICsgJ21iICdcclxuICB9IGVsc2UgaWYgKChieXRlcyA+PSBnaWdhYnl0ZSkgJiYgKGJ5dGVzIDwgdGVyYWJ5dGUpKSB7XHJcbiAgICByZXR1cm4gKGJ5dGVzIC8gZ2lnYWJ5dGUpLnRvRml4ZWQocHJlY2lzaW9uKSArICdnYiAnXHJcbiAgfSBlbHNlIGlmIChieXRlcyA+PSB0ZXJhYnl0ZSkge1xyXG4gICAgcmV0dXJuIChieXRlcyAvIHRlcmFieXRlKS50b0ZpeGVkKHByZWNpc2lvbikgKyAndGIgJ1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gYnl0ZXMgKyAnYiAnXHJcbiAgfVxyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIENvbG9yIFByb2Nlc3Mgc3RhdGVcclxuICogQG1ldGhvZCBjb2xvclN0YXR1c1xyXG4gKiBAcGFyYW0ge30gc3RhdHVzXHJcbiAqIEByZXR1cm5cclxuICovXHJcbkhlbHBlcnMuY29sb3JTdGF0dXMgPSBmdW5jdGlvbihzdGF0dXMpIHtcclxuICBzd2l0Y2ggKHN0YXR1cykge1xyXG5cclxuICBjYXNlICdvbmxpbmUnOlxyXG4gICAgcmV0dXJuIGNoYWxrLmdyZWVuLmJvbGQoJ29ubGluZScpXHJcbiAgICBicmVha1xyXG4gIGNhc2UgJ3J1bm5pbmcnOlxyXG4gICAgcmV0dXJuIGNoYWxrLmdyZWVuLmJvbGQoJ29ubGluZScpXHJcbiAgICBicmVha1xyXG4gIGNhc2UgJ3Jlc3RhcnRpbmcnOlxyXG4gICAgcmV0dXJuIGNoYWxrLnllbGxvdy5ib2xkKCdyZXN0YXJ0JylcclxuICAgIGJyZWFrXHJcbiAgY2FzZSAnY3JlYXRlZCc6XHJcbiAgICByZXR1cm4gY2hhbGsueWVsbG93LmJvbGQoJ2NyZWF0ZWQnKVxyXG4gICAgYnJlYWtcclxuICBjYXNlICdsYXVuY2hpbmcnOlxyXG4gICAgcmV0dXJuIGNoYWxrLmJsdWUuYm9sZCgnbGF1bmNoaW5nJylcclxuICAgIGJyZWFrXHJcbiAgZGVmYXVsdDpcclxuICAgIHJldHVybiBjaGFsay5yZWQuYm9sZChzdGF0dXMpXHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogU2FmZSBQdXNoXHJcbiAqL1xyXG5IZWxwZXJzLnNhZmVfcHVzaCA9IGZ1bmN0aW9uKCkge1xyXG4gIHZhciBhcmd2ID0gYXJndW1lbnRzXHJcbiAgdmFyIHRhYmxlID0gYXJndlswXVxyXG5cclxuICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3YubGVuZ3RoOyArK2kpIHtcclxuICAgIHZhciBlbGVtID0gYXJndltpXVxyXG4gICAgaWYgKGVsZW1bT2JqZWN0LmtleXMoZWxlbSlbMF1dID09PSB1bmRlZmluZWRcclxuICAgICAgICB8fCBlbGVtW09iamVjdC5rZXlzKGVsZW0pWzBdXSA9PT0gbnVsbCkge1xyXG4gICAgICBlbGVtW09iamVjdC5rZXlzKGVsZW0pWzBdXSA9ICdOL0EnXHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KGVsZW1bT2JqZWN0LmtleXMoZWxlbSlbMF1dKSkge1xyXG4gICAgICBlbGVtW09iamVjdC5rZXlzKGVsZW0pWzBdXS5mb3JFYWNoKGZ1bmN0aW9uKGN1cnIsIGopIHtcclxuICAgICAgICBpZiAoY3VyciA9PT0gdW5kZWZpbmVkIHx8IGN1cnIgPT09IG51bGwpXHJcbiAgICAgICAgICBlbGVtW09iamVjdC5rZXlzKGVsZW0pWzBdXVtqXSA9ICdOL0EnXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICB0YWJsZS5wdXNoKGVsZW0pXHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRGVzY3JpcHRpb25cclxuICogQG1ldGhvZCB0aW1lU2luY2VcclxuICogQHBhcmFtIHt9IGRhdGVcclxuICogQHJldHVybiBCaW5hcnlFeHByZXNzaW9uXHJcbiAqL1xyXG5IZWxwZXJzLnRpbWVTaW5jZSA9IGZ1bmN0aW9uKGRhdGUpIHtcclxuICAvLyBUT0RPOiBwbGVhc2UgY2hlY2sgdGhpc1xyXG4gIHZhciBzZWNvbmRzID0gTWF0aC5mbG9vcihtb21lbnQoKS5zdWJ0cmFjdChkYXRlLCBcImRheXNcIikudW5peCgpIC8gMTAwMClcclxuXHJcbiAgdmFyIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzE1MzYwMDApXHJcblxyXG4gIGlmIChpbnRlcnZhbCA+IDEpIHtcclxuICAgIHJldHVybiBpbnRlcnZhbCArICdZJ1xyXG4gIH1cclxuICBpbnRlcnZhbCA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDI1OTIwMDApXHJcbiAgaWYgKGludGVydmFsID4gMSkge1xyXG4gICAgcmV0dXJuIGludGVydmFsICsgJ00nXHJcbiAgfVxyXG4gIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gODY0MDApXHJcbiAgaWYgKGludGVydmFsID4gMSkge1xyXG4gICAgcmV0dXJuIGludGVydmFsICsgJ0QnXHJcbiAgfVxyXG4gIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMClcclxuICBpZiAoaW50ZXJ2YWwgPiAxKSB7XHJcbiAgICByZXR1cm4gaW50ZXJ2YWwgKyAnaCdcclxuICB9XHJcbiAgaW50ZXJ2YWwgPSBNYXRoLmZsb29yKHNlY29uZHMgLyA2MClcclxuICBpZiAoaW50ZXJ2YWwgPiAxKSB7XHJcbiAgICByZXR1cm4gaW50ZXJ2YWwgKyAnbSdcclxuICB9XHJcbiAgcmV0dXJuIE1hdGguZmxvb3Ioc2Vjb25kcykgKyAncydcclxufVxyXG5cclxuLyoqXHJcbiAqIENvbG9yaXplIE1ldHJpY3NcclxuICpcclxuICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIGN1cnJlbnQgdmFsdWVcclxuICogQHBhcmFtIHtOdW1iZXJ9IHdhcm4gdmFsdWUgdGhyZXNob2xkXHJcbiAqIEBwYXJhbSB7TnVtYmVyfSBhbGVydCB2YWx1ZSB0aHJlc2hvbGRcclxuICogQHBhcmFtIHtTdHJpbmd9IHByZWZpeCB2YWx1ZSBwcmVmaXhcclxuICogQHJldHVybiB7U3RyaW5nfSB2YWx1ZVxyXG4gKi9cclxuSGVscGVycy5jb2xvcml6ZWRNZXRyaWMgPSBmdW5jdGlvbih2YWx1ZSwgd2FybiwgYWxlcnQsIHByZWZpeCkge1xyXG4gIHZhciBpbnZlcnRlZCA9IGZhbHNlXHJcbiAgaWYgKGFsZXJ0IDwgd2FybilcclxuICAgIGludmVydGVkID0gdHJ1ZVxyXG5cclxuICBpZiAoIXByZWZpeCkgcHJlZml4ID0gJydcclxuICBpZiAoaXNOYU4odmFsdWUpID09PSB0cnVlKVxyXG4gICAgcmV0dXJuICdOL0EnXHJcbiAgaWYgKHZhbHVlID09IDApXHJcbiAgICByZXR1cm4gMCArIHByZWZpeFxyXG4gIGlmIChpbnZlcnRlZCA9PSB0cnVlKSB7XHJcbiAgICBpZiAodmFsdWUgPiB3YXJuKVxyXG4gICAgICByZXR1cm4gY2hhbGsuZ3JlZW4odmFsdWUgKyBwcmVmaXgpXHJcbiAgICBpZiAodmFsdWUgPD0gd2FybiAmJiB2YWx1ZSA+PSBhbGVydClcclxuICAgICAgcmV0dXJuIGNoYWxrLmJvbGQueWVsbG93KHZhbHVlICsgcHJlZml4KVxyXG4gICAgcmV0dXJuIGNoYWxrLmJvbGQucmVkKHZhbHVlICsgcHJlZml4KVxyXG4gIH1cclxuICBpZiAodmFsdWUgPCB3YXJuKVxyXG4gICAgcmV0dXJuIGNoYWxrLmdyZWVuKHZhbHVlICsgcHJlZml4KVxyXG4gIGlmICh2YWx1ZSA+PSB3YXJuICYmIHZhbHVlIDw9IGFsZXJ0KVxyXG4gICAgcmV0dXJuIGNoYWxrLmJvbGQueWVsbG93KHZhbHVlICsgcHJlZml4KVxyXG4gIHJldHVybiBjaGFsay5ib2xkLnJlZCh2YWx1ZSArIHByZWZpeClcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBuZXN0ZWQgcHJvcGVydHlcclxuICpcclxuICogQHBhcmFtIHtTdHJpbmd9IHByb3BlcnR5TmFtZVxyXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqXHJcbiAqIEByZXR1cm5zIHtTdHJpbmd9IHByb3BlcnR5IHZhbHVlXHJcbiAqL1xyXG5IZWxwZXJzLmdldE5lc3RlZFByb3BlcnR5ID0gZnVuY3Rpb24ocHJvcGVydHlOYW1lLCBvYmopIHtcclxuICB2YXIgcGFydHMgPSBwcm9wZXJ0eU5hbWUuc3BsaXQoJy4nKSxcclxuICAgICAgbGVuZ3RoID0gcGFydHMubGVuZ3RoLFxyXG4gICAgICBwcm9wZXJ0eSA9IG9iaiB8fCB7fVxyXG5cclxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrICkge1xyXG4gICAgcHJvcGVydHkgPSBwcm9wZXJ0eVtwYXJ0c1tpXV1cclxuICB9XHJcblxyXG4gIHJldHVybiBwcm9wZXJ0eVxyXG59XHJcblxyXG5IZWxwZXJzLm9wZW5FZGl0b3IgPSBmdW5jdGlvbiAoZmlsZSwgb3B0cywgY2IpIHtcclxuICB2YXIgc3Bhd24gPSByZXF1aXJlKCdjaGlsZF9wcm9jZXNzJykuc3Bhd25cclxuXHJcbiAgaWYgKHR5cGVvZiBvcHRzID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICBjYiA9IG9wdHNcclxuICAgIG9wdHMgPSB7fVxyXG4gIH1cclxuXHJcbiAgaWYgKCFvcHRzKSBvcHRzID0ge31cclxuXHJcbiAgdmFyIGVkID0gL153aW4vLnRlc3QocHJvY2Vzcy5wbGF0Zm9ybSkgPyAnbm90ZXBhZCcgOiAndmltJ1xyXG4gIHZhciBlZGl0b3IgPSBvcHRzLmVkaXRvciB8fCBwcm9jZXNzLmVudi5WSVNVQUwgfHwgcHJvY2Vzcy5lbnYuRURJVE9SIHx8IGVkXHJcbiAgdmFyIGFyZ3MgPSBlZGl0b3Iuc3BsaXQoL1xccysvKVxyXG4gIHZhciBiaW4gPSBhcmdzLnNoaWZ0KClcclxuXHJcbiAgdmFyIHBzID0gc3Bhd24oYmluLCBhcmdzLmNvbmNhdChbIGZpbGUgXSksIHsgc3RkaW86ICdpbmhlcml0JyB9KVxyXG5cclxuICBwcy5vbignZXhpdCcsIGZ1bmN0aW9uIChjb2RlLCBzaWcpIHtcclxuICAgIGlmICh0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIGNiKGNvZGUsIHNpZylcclxuICB9KVxyXG59XHJcblxyXG5cclxuSGVscGVycy5kaXNwS2V5cyA9IGZ1bmN0aW9uKGt2LCB0YXJnZXRfbW9kdWxlKSB7XHJcbiAgT2JqZWN0LmtleXMoa3YpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XHJcblxyXG4gICAgaWYgKHRhcmdldF9tb2R1bGUgIT0gbnVsbCAmJiB0YXJnZXRfbW9kdWxlICE9IGtleSlcclxuICAgICAgcmV0dXJuIGZhbHNlXHJcblxyXG4gICAgaWYgKHR5cGVvZihrdltrZXldKSA9PSAnb2JqZWN0Jykge1xyXG4gICAgICB2YXIgb2JqID0ge31cclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGNoYWxrLmJvbGQoJ01vZHVsZTogJykgKyBjaGFsay5ib2xkLmJsdWUoa2V5KSlcclxuICAgICAgT2JqZWN0LmtleXMoa3Zba2V5XSkuZm9yRWFjaChmdW5jdGlvbihzdWJfa2V5KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYCQgcG0yIHNldCAke2tleX06JHtzdWJfa2V5fSAke2t2W2tleV1bc3ViX2tleV19YClcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9KVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBIZWxwZXJzXHJcbiJdfQ==